import{_ as s}from"./plugin-vue_export-helper-x3n3nnut.js";import{o as n,c as a,f as e}from"./app-5g2Grfu7.js";const t={},i=e(`<h1 id="elasticsearch-备份和迁移" tabindex="-1"><a class="header-anchor" href="#elasticsearch-备份和迁移" aria-hidden="true">#</a> ElasticSearch - 备份和迁移</h1><h2 id="方案" tabindex="-1"><a class="header-anchor" href="#方案" aria-hidden="true">#</a> 方案</h2><h3 id="离线方案" tabindex="-1"><a class="header-anchor" href="#离线方案" aria-hidden="true">#</a> 离线方案</h3><ul><li>Snapshot</li><li>Reindex</li><li>Logstash</li><li>ElasticSearch-dump</li><li>ElasticSearch-Exporter</li></ul><h3 id="增量备份方案" tabindex="-1"><a class="header-anchor" href="#增量备份方案" aria-hidden="true">#</a> 增量备份方案</h3><ul><li>logstash</li></ul><h2 id="使用快照进行备份" tabindex="-1"><a class="header-anchor" href="#使用快照进行备份" aria-hidden="true">#</a> 使用快照进行备份</h2><h3 id="配置信息" tabindex="-1"><a class="header-anchor" href="#配置信息" aria-hidden="true">#</a> 配置信息</h3><p>注册前要注意配置文件加上: elasticsearch.yml</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>path.repo: <span class="token punctuation">[</span><span class="token string">&quot;/opt/elasticsearch/backup&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="创建仓库" tabindex="-1"><a class="header-anchor" href="#创建仓库" aria-hidden="true">#</a> 创建仓库</h3><blockquote><p>注册一个仓库，存放快照，记住，这里不是生成快照，只是注册一个仓库</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-XPUT</span> <span class="token string">&#39;http://10.11.60.5:9200/_snapshot/repo_backup_1&#39;</span> <span class="token parameter variable">-H</span> <span class="token string">&#39;Content-Type: application/json&#39;</span> <span class="token parameter variable">-d</span> <span class="token string">&#39;{
	&quot;type&quot;: &quot;fs&quot;,
	&quot;settings&quot;: {
		&quot;location&quot;: &quot;/opt/elasticsearch/backup&quot;,
		&quot;max_snapshot_bytes_per_sec&quot;: &quot;20mb&quot;,
		&quot;max_restore_bytes_per_sec&quot;: &quot;20mb&quot;,
		&quot;compress&quot;: true
	}
}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看仓库信息:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-XGET</span> <span class="token string">&#39;http://10.11.60.5:9200/_snapshot/repo_backup_1?pretty&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>返回内容</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@STOR-ES elasticsearch<span class="token punctuation">]</span><span class="token comment"># curl -XGET &#39;http://10.11.60.5:9200/_snapshot/repo_backup_1?pretty&#39;</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;repo_backup_1&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;type&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;fs&quot;</span>,
    <span class="token string">&quot;settings&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;location&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;/opt/elasticsearch/backup&quot;</span>,
      <span class="token string">&quot;max_restore_bytes_per_sec&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;20mb&quot;</span>,
      <span class="token string">&quot;compress&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;true&quot;</span>,
      <span class="token string">&quot;max_snapshot_bytes_per_sec&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;20mb&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建快照" tabindex="-1"><a class="header-anchor" href="#创建快照" aria-hidden="true">#</a> 创建快照</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-XPUT</span> <span class="token string">&#39;http://10.11.60.5:9200/_snapshot/repo_backup_1/snapshot_1?wait_for_completion=true&amp;pretty&#39;</span> <span class="token parameter variable">-H</span> <span class="token string">&#39;Content-Type: application/json&#39;</span> <span class="token parameter variable">-d</span> <span class="token string">&#39;{
	&quot;indices&quot;: &quot;bro-2019-09-14,bro-2019-09-15,wmi-2019-09-14,wmi-2019-09-15,syslog-2019-09-14,sylog-2019-09-15&quot;,
	&quot;rename_pattern&quot;: &quot;bro_(.+)&quot;,
	&quot;rename_replacement&quot;: &quot;dev_bro_$1&quot;,
	&quot;ignore_unavailable&quot;: true,
	&quot;include_global_state&quot;: true
}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;snapshot&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;snapshot&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;snapshot_1&quot;</span>,
    <span class="token string">&quot;version_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2040399</span>,
    <span class="token string">&quot;version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2.4.3&quot;</span>,
    <span class="token string">&quot;indices&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;bro-2019-09-14&quot;</span>, <span class="token string">&quot;bro-2019-09-15&quot;</span>, <span class="token string">&quot;wmi-2019-09-15&quot;</span>, <span class="token string">&quot;syslog-2019-09-14&quot;</span>, <span class="token string">&quot;wmi-2019-09-14&quot;</span> <span class="token punctuation">]</span>,
    <span class="token string">&quot;state&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;SUCCESS&quot;</span>,
    <span class="token string">&quot;start_time&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2019-09-18T05:58:08.860Z&quot;</span>,
    <span class="token string">&quot;start_time_in_millis&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1568786288860</span>,
    <span class="token string">&quot;end_time&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2019-09-18T06:02:18.037Z&quot;</span>,
    <span class="token string">&quot;end_time_in_millis&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1568786538037</span>,
    <span class="token string">&quot;duration_in_millis&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">249177</span>,
    <span class="token string">&quot;failures&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>,
    <span class="token string">&quot;shards&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;total&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span>,
      <span class="token string">&quot;failed&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">&quot;successful&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="恢复数据" tabindex="-1"><a class="header-anchor" href="#恢复数据" aria-hidden="true">#</a> 恢复数据</h3><h2 id="方案使用场景" tabindex="-1"><a class="header-anchor" href="#方案使用场景" aria-hidden="true">#</a> 方案使用场景</h2><h2 id="迁移考虑的问题" tabindex="-1"><a class="header-anchor" href="#迁移考虑的问题" aria-hidden="true">#</a> 迁移考虑的问题</h2><ul><li>版本问题，从低版本到高版本数据的迁移</li><li>多租户的适配问题</li></ul><blockquote><p>多个工厂的数据进入不同index, 原有的数据bro-2019-09-15的数据需要进入factorycode-bro-2019-09-15</p></blockquote><ul><li>多次或者分批迁移数据</li><li>数据在迁移时候富化</li><li>FieldMapping 和 数据信息 分离?</li></ul>`,27),l=[i];function o(c,p){return n(),a("div",null,l)}const d=s(t,[["render",o],["__file","elasticsearch-backup.html.vue"]]);export{d as default};
