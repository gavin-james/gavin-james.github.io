import{_ as t}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as p,o as c,c as o,a as n,b as s,d as l,f as a}from"./app-IRwI16JE.js";const r={},i=a(`<h1 id="工具-netstat查看服务及监听端口详解" tabindex="-1"><a class="header-anchor" href="#工具-netstat查看服务及监听端口详解" aria-hidden="true">#</a> 工具: netstat查看服务及监听端口详解</h1><blockquote><p>在Linux使用过程中，需要了解当前系统开放了哪些端口，并且要查看开放这些端口的具体进程和用户，可以通过netstat命令进行简单查询.</p></blockquote><h2 id="netstat的参数" tabindex="-1"><a class="header-anchor" href="#netstat的参数" aria-hidden="true">#</a> netstat的参数</h2><p>netstat命令各个参数说明如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token parameter variable">-a</span>   或–all                             显示所有连线中的Socket。
<span class="token parameter variable">-A</span>                                       <span class="token operator">&lt;</span>网络类型<span class="token operator">&gt;</span>或–<span class="token operator">&lt;</span>网络类型<span class="token operator">&gt;</span> 列出该网络类型连线中的相关地址。
<span class="token parameter variable">-c</span>   或–continuous               持续列出网络状态。
<span class="token parameter variable">-C</span> 或–cache                       显示路由器配置的快取信息。
<span class="token parameter variable">-e</span>  或–extend                     显示网络其他相关信息。
<span class="token parameter variable">-F</span>  或 –fib                          显示FIB。
<span class="token parameter variable">-g</span>  或–groups                     显示多重广播功能群组组员名单。
<span class="token parameter variable">-h</span>  或–help                        在线帮助。
<span class="token parameter variable">-i</span>   或–interfaces                 显示网络界面信息表单。
<span class="token parameter variable">-l</span>  或–listening                    显示监控中的服务器的Socket。
<span class="token parameter variable">-M</span>   或–masquerade           显示伪装的网络连线。
<span class="token parameter variable">-n</span>  或–numeric                   直接使用IP地址，而不通过域名服务器。
<span class="token parameter variable">-N</span>   或–netlink或–symbolic  显示网络硬件外围设备的符号连接名称。
<span class="token parameter variable">-o</span>  或–timers                      显示计时器。
<span class="token parameter variable">-p</span>   或–programs                显示正在使用Socket的程序识别码和程序名称。
<span class="token parameter variable">-r</span>  或–route                        显示 Routing Table。
<span class="token parameter variable">-s</span>  或–statistice 显示网络工作信息统计表。
<span class="token parameter variable">-t</span>  或–tcp 显示TCP 传输协议的连线状况。
-u或–udp 显示UDP传输协议的连线状况。
-v或–verbose 显示指令执行过程。
<span class="token parameter variable">-V</span> 或–version 显示版本信息。
-w或–raw 显示RAW传输协议的连线状况。
-x或–unix 此参数的效果和指定”-A unix”参数相同。
–ip或–inet 此参数的效果和指定”-A inet”参数相同。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="netstat输出内容" tabindex="-1"><a class="header-anchor" href="#netstat输出内容" aria-hidden="true">#</a> netstat输出内容</h2><p>以查看当前所有tcp/udp端口为例：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root ~<span class="token punctuation">]</span><span class="token comment"># netstat -tulnp</span>
Active Internet connections <span class="token punctuation">(</span>servers and established<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:22                  <span class="token number">0.0</span>.0.0:*                   LISTEN      <span class="token number">1904</span>/sshd           
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:631               <span class="token number">0.0</span>.0.0:*                   LISTEN      <span class="token number">1750</span>/cupsd          
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:44567               <span class="token number">0.0</span>.0.0:*                   LISTEN      <span class="token number">1713</span>/rpc.statd      
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:10050               <span class="token number">0.0</span>.0.0:*                   LISTEN      <span class="token number">1965</span>/zabbix_agentd  
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">172.172</span>.230.xxx:3306        <span class="token number">0.0</span>.0.0:*                   LISTEN      <span class="token number">31849</span>/mysqld        
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:111                 <span class="token number">0.0</span>.0.0:*                   LISTEN      <span class="token number">1576</span>/rpcbind        
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">172.172</span>.230.xxx:46327       <span class="token number">172.172</span>.100.3:80            TIME_WAIT   -                   
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">172.172</span>.230.xxx:46329       <span class="token number">172.172</span>.100.3:80            TIME_WAIT   -                   
tcp        <span class="token number">0</span>     <span class="token number">52</span> <span class="token number">172.172</span>.230.xxx:22          <span class="token number">172.172</span>.173.222:50043       ESTABLISHED <span class="token number">6095</span>/sshd           
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">172.172</span>.230.xxx:46326       <span class="token number">172.172</span>.100.3:80            TIME_WAIT   -                   
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">172.172</span>.230.xxx:5401        <span class="token number">172.172</span>.100.3:443           TIME_WAIT   -                   
tcp        <span class="token number">0</span>      <span class="token number">0</span> :::22                       :::*                        LISTEN      <span class="token number">1904</span>/sshd           
tcp        <span class="token number">0</span>      <span class="token number">0</span> ::1:631                     :::*                        LISTEN      <span class="token number">1750</span>/cupsd          
tcp        <span class="token number">0</span>      <span class="token number">0</span> :::11776                    :::*                        LISTEN      <span class="token number">1713</span>/rpc.statd      
tcp        <span class="token number">0</span>      <span class="token number">0</span> :::10050                    :::*                        LISTEN      <span class="token number">1965</span>/zabbix_agentd  
tcp        <span class="token number">0</span>      <span class="token number">0</span> :::111                      :::*                        LISTEN      <span class="token number">1576</span>/rpcbind       
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对上述返回内容进一步解释如下：</p><h3 id="proto-recv-q-send-q" tabindex="-1"><a class="header-anchor" href="#proto-recv-q-send-q" aria-hidden="true">#</a> Proto，Recv-Q，Send-Q</h3><p><strong>Proto</strong>:协议名（tcp协议还是udp协议)</p><p><strong>recv-Q</strong>: 网络接收队列</p><p>表示收到的数据已经在本地接收缓冲，但是还有多少没有被进程取走，recv() 如果接收队列Recv-Q一直处于阻塞状态，可能是遭受了拒绝服务 denial-of-service 攻击。</p><p><strong>send-Q</strong>: 网路发送队列 对方没有收到的数据或者说没有Ack的,还是本地缓冲区. 如果发送队列Send-Q不能很快的清零，可能是有应用向外发送数据包过快，或者是对方接收数据包不够快。</p><p>这两个值通常应该为0，如果不为0可能是有问题的。packets在两个队列里都不应该有堆积状态。可接受短暂的非0情况。</p><p>从步骤一的结果中可以看到22端口对应的链路的 send-Q中堆积了大量的数据包 ,可以判定是发送数据给目的地址的时候出现了阻塞的问题，导致了包堆积在本地缓存中，不能成功发出去。</p><h3 id="local-address" tabindex="-1"><a class="header-anchor" href="#local-address" aria-hidden="true">#</a> Local Address</h3>`,17),u={href:"http://172.172.230.xxx",target:"_blank",rel:"noopener noreferrer"},d=n("li",null,[n("code",null,":::22"),s(' 这个也表示监听本地所有ip的22端口，跟上面的区别是这里表示的是IPv6地址，上面的0.0.0.0表示的是本地所有IPv4地址 NOTE “:::” 这三个: 的前两个"::"，是"0:0:0:0:0:0:0:0"的缩写，相当于IPv6的"0.0.0.0"，就是本机的所有IPv6地址，第三个:是IP和端口的分隔符')],-1),b=n("li",null,[n("code",null,"127.0.0.1:631"),s(" 这个表示监听本机的loopback地址的631端口(如果某个服务只监听了回环地址，那么只能在本机进行访问，无法通过tcp/ip 协议进行远程访问)")],-1),m=n("li",null,[n("code",null,"::1:631"),s(" 这个表示监听IPv6的回环地址的631端口,::1这个表示IPv6的loopback地址")],-1),k=n("li",null,[n("code",null,"172.172.230.xxx:3306"),s(" 这里我们看到我们的mysqld进程监听的是172.172.230.xxx的3306端口,这是因为我们在启动的时候指定了bind_address=172.172.230.xxx参数，如果不指定bind_address的话，mysqld默认监听:::3306(本机所有ip地址的3306端口 -IPv6)")],-1),v=a(`<h3 id="foreign-address" tabindex="-1"><a class="header-anchor" href="#foreign-address" aria-hidden="true">#</a> Foreign Address</h3><p>与本机端口通信的外部socket。显示规则与Local Address相同</p><h3 id="state" tabindex="-1"><a class="header-anchor" href="#state" aria-hidden="true">#</a> State</h3><p>共有11种链路状态 + Unknown，共计12种state值，前面11种是按照TCP连接建立的三次握手和TCP连接断开的四次挥手过程来描述的。</p><table><thead><tr><th>状态</th><th>描述</th></tr></thead><tbody><tr><td>LISTEN</td><td>首先服务端需要打开一个socket进行监听，状态为LISTEN./* The socket is listening for incoming connections. 侦听来自远方TCP端口的连接请求 */</td></tr><tr><td>SYN_SENT</td><td>客户端通过应用程序调用connect进行active open.于是客户端tcp发送一个SYN以请求建立一个连接.之后状态置为SYN_SENT./*The socket is actively attempting to establish a connection. 在发送连接请求后等待匹配的连接请求 */</td></tr><tr><td>SYN_RECV</td><td>服务端应发出ACK确认客户端的 SYN,同时自己向客户端发送一个SYN. 之后状态置为SYN_RECV/* A connection request has been received from the network. 在收到和发送一个连接请求后等待对连接请求的确认 */</td></tr><tr><td>ESTABLISHED</td><td>代表一个打开的连接，双方可以进行或已经在数据交互了。/* The socket has an established connection. 代表一个打开的连接，数据可以传送给用户 */</td></tr><tr><td>FIN_WAIT1</td><td>主动关闭(active close)端应用程序调用close，于是其TCP发出FIN请求主动关闭连接，之后进入FIN_WAIT1状态./* The socket is closed, and the connection is shutting down. 等待远程TCP的连接中断请求，或先前的连接中断请求的确认 */</td></tr><tr><td>CLOSE_WAIT</td><td>被动关闭(passive close)端TCP接到FIN后，就发出ACK以回应FIN请求(它的接收也作为文件结束符传递给上层应用程序),并进入CLOSE_WAIT./* The remote end has shut down, waiting for the socket to close. 等待从本地用户发来的连接中断请求 */</td></tr><tr><td>FIN_WAIT2</td><td>主动关闭端接到ACK后，就进入了 FIN-WAIT-2 ./* Connection is closed, and the socket is waiting for a shutdown from the remote end. 从远程TCP等待连接中断请求 */</td></tr><tr><td>LAST_ACK</td><td>被动关闭端一段时间后，接收到文件结束符的应用程 序将调用CLOSE关闭连接。这导致它的TCP也发送一个 FIN,等待对方的ACK.就进入了LAST-ACK ./* The remote end has shut down, and the socket is closed. Waiting for acknowledgement. 等待原来发向远程TCP的连接中断请求的确认 */</td></tr><tr><td>TIME_WAIT</td><td>在主动关闭端接收到FIN后，TCP 就发送ACK包，并进入TIME-WAIT状态。/* The socket is waiting after close to handle packets still in the network.等待足够的时间以确保远程TCP接收到连接中断请求的确认 */</td></tr><tr><td>CLOSING</td><td>比较少见./* Both sockets are shut down but we still don’t have all our data sent. 等待远程TCP对连接中断的确认 */</td></tr><tr><td>CLOSED</td><td>被动关闭端在接受到ACK包后，就进入了closed的状态。连接结束./* The socket is not being used. 没有任何连接状态 */</td></tr><tr><td>UNKNOWN</td><td>未知的Socket状态。/* The state of the socket is unknown. */</td></tr></tbody></table><p>备注</p><ul><li><code>SYN</code>: (同步序列编号,Synchronize Sequence Numbers)该标志仅在三次握手建立TCP连接时有效。表示一个新的TCP连接请求。</li><li><code>ACK</code>: (确认编号,Acknowledgement Number)是对TCP请求的确认标志,同时提示对端系统已经成功接收所有数据。</li><li><code>FIN</code>: (结束标志,FINish)用来结束一个TCP回话.但对应端口仍处于开放状态,准备接收后续数据。</li></ul><h3 id="pid-program" tabindex="-1"><a class="header-anchor" href="#pid-program" aria-hidden="true">#</a> PID/Program</h3><p>PID即进程id，Program即使用该socket的应用程序</p><h2 id="常用的一些命令" tabindex="-1"><a class="header-anchor" href="#常用的一些命令" aria-hidden="true">#</a> 常用的一些命令</h2><p><code>netstat -t/-u/-l/-r/-n</code>【显示网络相关信息,-t:TCP协议,-u:UDP协议,-l:监听,-r:路由,-n:显示IP地址和端口号】</p><p>注：以下返回内容中，我用xxx注释掉了一部分敏感ip地址。</p><h3 id="显示协议统计信息和tcp-ip网络连接" tabindex="-1"><a class="header-anchor" href="#显示协议统计信息和tcp-ip网络连接" aria-hidden="true">#</a> 显示协议统计信息和TCP/IP网络连接</h3><p>注：删减了部分结果</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root ~<span class="token punctuation">]</span><span class="token comment"># netstat -ano</span>
Active Internet connections <span class="token punctuation">(</span>servers and established<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       Timer
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:80              <span class="token number">0.0</span>.0.0:*               LISTEN      off <span class="token punctuation">(</span><span class="token number">0.00</span>/0/0<span class="token punctuation">)</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:443             <span class="token number">0.0</span>.0.0:*               LISTEN      off <span class="token punctuation">(</span><span class="token number">0.00</span>/0/0<span class="token punctuation">)</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">172.21</span>.0.14:443         <span class="token number">120.242</span>.11.29:15878     ESTABLISHED off <span class="token punctuation">(</span><span class="token number">0.00</span>/0/0<span class="token punctuation">)</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">172.21</span>.0.14:55758       <span class="token number">169.254</span>.0.4:80          TIME_WAIT   timewait <span class="token punctuation">(</span><span class="token number">33.29</span>/0/0<span class="token punctuation">)</span>
tcp        <span class="token number">0</span>   <span class="token number">6728</span> <span class="token number">172.21</span>.0.14:443         <span class="token number">183.249</span>.4.28:52323      ESTABLISHED on <span class="token punctuation">(</span><span class="token number">0.05</span>/0/0<span class="token punctuation">)</span>
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::3306                 :::*                    LISTEN      off <span class="token punctuation">(</span><span class="token number">0.00</span>/0/0<span class="token punctuation">)</span>
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:68              <span class="token number">0.0</span>.0.0:*                           off <span class="token punctuation">(</span><span class="token number">0.00</span>/0/0<span class="token punctuation">)</span>
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">172.21</span>.0.14:123         <span class="token number">0.0</span>.0.0:*                           off <span class="token punctuation">(</span><span class="token number">0.00</span>/0/0<span class="token punctuation">)</span>
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:123           <span class="token number">0.0</span>.0.0:*                           off <span class="token punctuation">(</span><span class="token number">0.00</span>/0/0<span class="token punctuation">)</span>
udp6       <span class="token number">0</span>      <span class="token number">0</span> fe80::5054:ff:fe2b::123 :::*                                off <span class="token punctuation">(</span><span class="token number">0.00</span>/0/0<span class="token punctuation">)</span>
udp6       <span class="token number">0</span>      <span class="token number">0</span> ::1:123                 :::*                                off <span class="token punctuation">(</span><span class="token number">0.00</span>/0/0<span class="token punctuation">)</span>
Active UNIX domain sockets <span class="token punctuation">(</span>servers and established<span class="token punctuation">)</span>
Proto RefCnt Flags       Type       State         I-Node   Path
unix  <span class="token number">2</span>      <span class="token punctuation">[</span> ACC <span class="token punctuation">]</span>     STREAM     LISTENING     <span class="token number">67561565</span> /usr/local/yd.socket.server
unix  <span class="token number">2</span>      <span class="token punctuation">[</span> ACC <span class="token punctuation">]</span>     STREAM     LISTENING     <span class="token number">13619</span>    /var/run/acpid.socket
unix  <span class="token number">2</span>      <span class="token punctuation">[</span> ACC <span class="token punctuation">]</span>     STREAM     LISTENING     <span class="token number">12855</span>    /var/run/lsm/ipc/simc
unix  <span class="token number">2</span>      <span class="token punctuation">[</span> ACC <span class="token punctuation">]</span>     STREAM     LISTENING     <span class="token number">12857</span>    /var/run/lsm/ipc/sim
unix  <span class="token number">2</span>      <span class="token punctuation">[</span> <span class="token punctuation">]</span>         DGRAM                    <span class="token number">10062</span>    /run/systemd/shutdownd
unix  <span class="token number">2</span>      <span class="token punctuation">[</span> <span class="token punctuation">]</span>         DGRAM                    <span class="token number">15773</span>    
unix  <span class="token number">3</span>      <span class="token punctuation">[</span> <span class="token punctuation">]</span>         STREAM     CONNECTED     <span class="token number">67561623</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看本机监听的端口" tabindex="-1"><a class="header-anchor" href="#查看本机监听的端口" aria-hidden="true">#</a> 查看本机监听的端口</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root ~<span class="token punctuation">]</span><span class="token comment"># netstat -tlun</span>
Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:80              <span class="token number">0.0</span>.0.0:*               LISTEN      
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:22              <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:443             <span class="token number">0.0</span>.0.0:*               LISTEN                          
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">172.21</span>.0.14:123         <span class="token number">0.0</span>.0.0:*                          
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:123           <span class="token number">0.0</span>.0.0:*                          
udp6       <span class="token number">0</span>      <span class="token number">0</span> fe80::5054:ff:fe2b::123 :::*                               
udp6       <span class="token number">0</span>      <span class="token number">0</span> ::1:123                 :::*   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看本机路由表" tabindex="-1"><a class="header-anchor" href="#查看本机路由表" aria-hidden="true">#</a> 查看本机路由表</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root ~<span class="token punctuation">]</span><span class="token comment"># netstat -rn</span>
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
<span class="token number">0.0</span>.0.0         <span class="token number">172.21</span>.0.1      <span class="token number">0.0</span>.0.0         UG        <span class="token number">0</span> <span class="token number">0</span>          <span class="token number">0</span> eth0
<span class="token number">169.254</span>.0.0     <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.0.0     U         <span class="token number">0</span> <span class="token number">0</span>          <span class="token number">0</span> eth0
<span class="token number">172.21</span>.0.0      <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.240.0   U         <span class="token number">0</span> <span class="token number">0</span>          <span class="token number">0</span> eth0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列出所有端口" tabindex="-1"><a class="header-anchor" href="#列出所有端口" aria-hidden="true">#</a> 列出所有端口</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root ~<span class="token punctuation">]</span><span class="token comment"># netstat -a </span>
Active Internet connections <span class="token punctuation">(</span>servers and established<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
tcp        <span class="token number">0</span>      <span class="token number">0</span> VM-0-14-cent:cslistener <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:http            <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:us-srv          <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:ssh             <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:https           <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:https    <span class="token number">125.85</span>.238.55:7123      TIME_WAIT  
tcp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:https    <span class="token number">39.144</span>.22.5:50742       ESTABLISHED
<span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列出所有的tcp端口" tabindex="-1"><a class="header-anchor" href="#列出所有的tcp端口" aria-hidden="true">#</a> 列出所有的TCP端口</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root ~<span class="token punctuation">]</span><span class="token comment"># netstat -at</span>
Active Internet connections <span class="token punctuation">(</span>servers and established<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
tcp        <span class="token number">0</span>      <span class="token number">0</span> VM-0-14-cent:cslistener <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:http            <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:us-srv          <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:ssh             <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:https           <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:https    <span class="token number">39.144</span>.22.xx:50742       FIN_WAIT2  
tcp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:https    <span class="token number">59.71</span>.243.xx:6994      ESTABLISHED
tcp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:https    <span class="token number">125.85</span>.238.xx:7096      FIN_WAIT2  
tcp6       <span class="token number">0</span>      <span class="token number">0</span> <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:mysql              <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                  LISTEN     
tcp6       <span class="token number">0</span>      <span class="token number">0</span> <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:distinct           <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                  LISTEN     
tcp6       <span class="token number">0</span>      <span class="token number">0</span> <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:ddi-tcp-1          <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                  LISTEN     
tcp6       <span class="token number">1</span>      <span class="token number">0</span> <span class="token number">172.21</span>.0.14:ddi-tcp-1   <span class="token number">140.82</span>.115.xx:24923    CLOSE_WAIT 
tcp6       <span class="token number">1</span>      <span class="token number">0</span> <span class="token number">172.21</span>.0.14:ddi-tcp-1   <span class="token number">140.82</span>.115.xx:64953    CLOSE_WAIT 
tcp6       <span class="token number">1</span>      <span class="token number">0</span> <span class="token number">172.21</span>.0.14:ddi-tcp-1   <span class="token number">140.82</span>.115.xx:55955    CLOSE_WAIT 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列出所有的udp端口" tabindex="-1"><a class="header-anchor" href="#列出所有的udp端口" aria-hidden="true">#</a> 列出所有的UDP端口</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root ~<span class="token punctuation">]</span><span class="token comment"># netstat -au </span>
Active Internet connections <span class="token punctuation">(</span>servers and established<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:bootpc          <span class="token number">0.0</span>.0.0:*                          
udp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ntp      <span class="token number">0.0</span>.0.0:*                          
udp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ntp      <span class="token number">0.0</span>.0.0:*                          
udp6       <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ntp      <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                             
udp6       <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ntp      <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列出所有监听tcp端口的socket" tabindex="-1"><a class="header-anchor" href="#列出所有监听tcp端口的socket" aria-hidden="true">#</a> 列出所有监听TCP端口的socket</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root ~<span class="token punctuation">]</span><span class="token comment"># netstat -lt </span>
Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
tcp        <span class="token number">0</span>      <span class="token number">0</span> VM-0-14-cent:cslistener <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:http            <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:us-srv          <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:ssh             <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:https           <span class="token number">0.0</span>.0.0:*               LISTEN     
tcp6       <span class="token number">0</span>      <span class="token number">0</span> <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:mysql              <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                  LISTEN     
tcp6       <span class="token number">0</span>      <span class="token number">0</span> <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:distinct           <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                  LISTEN     
tcp6       <span class="token number">0</span>      <span class="token number">0</span> <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:ddi-tcp-1          <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                  LISTEN 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列出所有监听udp端口的socket" tabindex="-1"><a class="header-anchor" href="#列出所有监听udp端口的socket" aria-hidden="true">#</a> 列出所有监听UDP端口的socket</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root ~<span class="token punctuation">]</span><span class="token comment"># netstat -lu </span>
Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
udp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:bootpc          <span class="token number">0.0</span>.0.0:*                          
udp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ntp      <span class="token number">0.0</span>.0.0:*                          
udp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ntp      <span class="token number">0.0</span>.0.0:*                          
udp6       <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ntp      <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*                             
udp6       <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ntp      <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="找出程序运行的端口" tabindex="-1"><a class="header-anchor" href="#找出程序运行的端口" aria-hidden="true">#</a> 找出程序运行的端口</h3><p>以ssh为例</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@root ~<span class="token punctuation">]</span><span class="token comment"># netstat -ap | grep ssh </span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:ssh             <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1120</span>/sshd           
tcp        <span class="token number">0</span>     <span class="token number">64</span> pdai-centos:ssh      <span class="token number">117.82</span>.229.xx:41408    ESTABLISHED <span class="token number">28968</span>/sshd: xx@pt 
tcp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ssh      xxx.122.15.xx:32966     TIME_WAIT   -                   
tcp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ssh      <span class="token number">203</span>.xxx.85.146:43730    ESTABLISHED <span class="token number">687</span>/sshd: xx <span class="token punctuation">[</span>pri 
tcp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ssh      <span class="token number">134</span>.xx.xx.36:54474     TIME_WAIT   -                   
tcp        <span class="token number">0</span>      <span class="token number">0</span> pdai-centos:ssh      <span class="token number">64</span>.xx.111.127:45444    TIME_WAIT   -                   
unix  <span class="token number">3</span>      <span class="token punctuation">[</span> <span class="token punctuation">]</span>         STREAM     CONNECTED     <span class="token number">16580</span>    <span class="token number">1120</span>/sshd            
unix  <span class="token number">2</span>      <span class="token punctuation">[</span> <span class="token punctuation">]</span>         DGRAM                    <span class="token number">113619201</span> <span class="token number">28968</span>/sshd: root@pt  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="几个有用查找" tabindex="-1"><a class="header-anchor" href="#几个有用查找" aria-hidden="true">#</a> 几个有用查找</h3><p>1.查找请求数前20个IP（常用于查找攻来源）：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> -anlp<span class="token operator">|</span><span class="token function">grep</span> <span class="token number">80</span><span class="token operator">|</span><span class="token function">grep</span> tcp<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $5}&#39;</span><span class="token operator">|</span><span class="token function">awk</span> -F: <span class="token string">&#39;{print $1}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-n20</span>
 
<span class="token function">netstat</span> <span class="token parameter variable">-ant</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;/:80/{split($5,ip,”:”);++A[ip[1]]}END{for(i in A) print A[i],i}&#39;</span> <span class="token operator">|</span><span class="token function">sort</span> -rn<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-n20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.查找较多time_wait连接</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> -n<span class="token operator">|</span><span class="token function">grep</span> TIME_WAIT<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $5}&#39;</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -rn<span class="token operator">|</span><span class="token function">head</span> <span class="token parameter variable">-n20</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>4.找查较多的SYN连接</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-an</span> <span class="token operator">|</span> <span class="token function">grep</span> SYN <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $5}&#39;</span> <span class="token operator">|</span> <span class="token function">awk</span> -F: <span class="token string">&#39;{print $1}&#39;</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span> <span class="token function">more</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>5.根据端口列进程</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-ntlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">80</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $7}&#39;</span> <span class="token operator">|</span> <span class="token function">cut</span> -d/ <span class="token parameter variable">-f1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,41);function h(I,T){const e=p("ExternalLinkIcon");return c(),o("div",null,[i,n("ul",null,[n("li",null,[s("Local Address 部分的0.0.0.0:22 表示监听服务器上所有ip地址的所有(0.0.0.0表示本地所有ip)，比如你的服务器是有172.172.230.210和 172.172.230.11两个ip地址，那么0.0.0.0:22此时表示监听172.172.230.210,"),n("a",u,[s("172.172.230.xxx"),l(e)]),s(",127.0.0.1三个地址的22端口")]),d,b,m,k]),v])}const S=t(r,[["render",h],["__file","dev-protocol-tool-netstat.html.vue"]]);export{S as default};
