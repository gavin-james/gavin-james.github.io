import{_ as a}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as e,o as t,c as i,a as s,b as l,d as p,f as c}from"./app-IRwI16JE.js";const u={},o=c(`<h1 id="es详解-查询-dsl查询之term详解" tabindex="-1"><a class="header-anchor" href="#es详解-查询-dsl查询之term详解" aria-hidden="true">#</a> ES详解 - 查询：DSL查询之Term详解</h1><blockquote><p>DSL查询另一种极为常用的是对词项进行搜索，官方文档中叫”term level“查询，本文主要对term level搜索进行详解。</p></blockquote><h2 id="term查询引入" tabindex="-1"><a class="header-anchor" href="#term查询引入" aria-hidden="true">#</a> Term查询引入</h2><p>如前文所述，查询分基于文本查询和基于词项的查询:</p><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-full-text-3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>本文主要讲基于词项的查询。</p><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-term-1.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="term查询" tabindex="-1"><a class="header-anchor" href="#term查询" aria-hidden="true">#</a> Term查询</h2><blockquote><p>很多比较常用，也不难，就是需要结合实例理解。这里综合官方文档的内容，我设计一个测试场景的数据，以覆盖所有例子。</p></blockquote><p>准备数据</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>PUT /test-dsl-term-level
<span class="token punctuation">{</span>
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;programming_languages&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;required_matches&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;long&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST /test-dsl-term-level/_bulk
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Jane Smith&quot;</span>, <span class="token string">&quot;programming_languages&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;c++&quot;</span>, <span class="token string">&quot;java&quot;</span> <span class="token punctuation">]</span>, <span class="token string">&quot;required_matches&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Jason Response&quot;</span>, <span class="token string">&quot;programming_languages&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;php&quot;</span> <span class="token punctuation">]</span>, <span class="token string">&quot;required_matches&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Dave Pdai&quot;</span>, <span class="token string">&quot;programming_languages&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;c++&quot;</span>, <span class="token string">&quot;php&quot;</span> <span class="token punctuation">]</span>, <span class="token string">&quot;required_matches&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span>, <span class="token string">&quot;remarks&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="字段是否存在-exist" tabindex="-1"><a class="header-anchor" href="#字段是否存在-exist" aria-hidden="true">#</a> 字段是否存在:exist</h3><p>由于多种原因，文档字段的索引值可能不存在：</p><ul><li>源JSON中的字段是null或[]</li><li>该字段已&quot;index&quot; : false在映射中设置</li><li>字段值的长度超出ignore_above了映射中的设置</li><li>字段值格式错误，并且ignore_malformed已在映射中定义</li></ul><p>所以exist表示查找是否存在字段。</p><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-term-2.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="id查询-ids" tabindex="-1"><a class="header-anchor" href="#id查询-ids" aria-hidden="true">#</a> id查询:ids</h3><p>ids 即对id查找</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>GET /test-dsl-term-level/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ids&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;values&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">3</span>, <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-term-3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="前缀-prefix" tabindex="-1"><a class="header-anchor" href="#前缀-prefix" aria-hidden="true">#</a> 前缀:prefix</h3><p>通过前缀查找某个字段</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>GET /test-dsl-term-level/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Jan&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-term-4.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="分词匹配-term" tabindex="-1"><a class="header-anchor" href="#分词匹配-term" aria-hidden="true">#</a> 分词匹配:term</h3><p>前文最常见的根据分词查询</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>GET /test-dsl-term-level/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;term&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;programming_languages&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;php&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-term-5.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="多个分词匹配-terms" tabindex="-1"><a class="header-anchor" href="#多个分词匹配-terms" aria-hidden="true">#</a> 多个分词匹配:terms</h3><p>按照读个分词term匹配，它们是or的关系</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>GET /test-dsl-term-level/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;terms&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;programming_languages&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;php&quot;</span>,<span class="token string">&quot;c++&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-term-6.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="按某个数字字段分词匹配-term-set" tabindex="-1"><a class="header-anchor" href="#按某个数字字段分词匹配-term-set" aria-hidden="true">#</a> 按某个数字字段分词匹配:term set</h3><p>设计这种方式查询的初衷是用文档中的数字字段动态匹配查询满足term的个数</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>GET /test-dsl-term-level/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;terms_set&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;programming_languages&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;terms&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;php&quot;</span> <span class="token punctuation">]</span>,
        <span class="token string">&quot;minimum_should_match_field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;required_matches&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-term-7.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="通配符-wildcard" tabindex="-1"><a class="header-anchor" href="#通配符-wildcard" aria-hidden="true">#</a> 通配符:wildcard</h3><p>通配符匹配，比如<code>*</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>GET /test-dsl-term-level/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;wildcard&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;D*ai&quot;</span>,
        <span class="token string">&quot;boost&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1.0</span>,
        <span class="token string">&quot;rewrite&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;constant_score&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-term-8.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="范围-range" tabindex="-1"><a class="header-anchor" href="#范围-range" aria-hidden="true">#</a> 范围:range</h3><p>常常被用在数字或者日期范围的查询</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>GET /test-dsl-term-level/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;range&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;required_matches&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gte&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
        <span class="token string">&quot;lte&quot;</span><span class="token builtin class-name">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-term-9.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="正则-regexp" tabindex="-1"><a class="header-anchor" href="#正则-regexp" aria-hidden="true">#</a> 正则:regexp</h3><p>通过<a href="">正则表达式</a>查询</p><p>以&quot;Jan&quot;开头的name字段</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>GET /test-dsl-term-level/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;regexp&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Ja.*&quot;</span>,
        <span class="token string">&quot;case_insensitive&quot;</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-term-10.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="模糊匹配-fuzzy" tabindex="-1"><a class="header-anchor" href="#模糊匹配-fuzzy" aria-hidden="true">#</a> 模糊匹配:fuzzy</h3><p>官方文档对模糊匹配：编辑距离是将一个术语转换为另一个术语所需的一个字符更改的次数。这些更改可以包括：</p><ul><li>更改字符（box→ fox）</li><li>删除字符（black→ lack）</li><li>插入字符（sic→ sick）</li><li>转置两个相邻字符（act→ cat）</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>GET /test-dsl-term-level/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;fuzzy&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;remarks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;hell&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://www.pdai.tech/images/db/es/es-dsl-term-11.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2>`,55),r={href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/term-level-queries.html",target:"_blank",rel:"noopener noreferrer"};function d(m,v){const n=e("ExternalLinkIcon");return t(),i("div",null,[o,s("p",null,[s("a",r,[l("https://www.elastic.co/guide/en/elasticsearch/reference/current/term-level-queries.html"),p(n)])])])}const b=a(u,[["render",d],["__file","elasticsearch-x-dsl-term.html.vue"]]);export{b as default};
