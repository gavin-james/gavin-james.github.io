<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://www.gavin-james.com/develop/design/factory.html"><meta property="og:site_name" content="Gavin blog"><meta property="og:title" content="创建型工厂模式"><meta property="og:description" content="工厂模式概述 工厂模式很重要，后面的很多架构设计，都是工厂模式联合着其它设计模式使用。 一般情况下，工厂模式分为三种更加细分的类型：简单工厂、工厂方法和抽象工厂。不过，在 GOF 的《设计模式》一书中，它将简单工厂模式看作是工厂方法模式的一种特例，所以工厂模式只被分成了工厂方法和抽象工厂两类。实际上，前面一种分类方法更加常见，所以，在今天的讲解中，我们沿用第一种分类方法。 在这三种细分的工厂模式中，简单工厂、工厂方法原理比较简单，在实际的项目中也比较常用。而抽象工厂的原理稍微复杂点，在实际的项目中相对也不常用。"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-04-12T04:14:48.000Z"><meta property="article:author" content="gavin-james"><meta property="article:tag" content="设计模式"><meta property="article:published_time" content="2019-10-12T00:00:00.000Z"><meta property="article:modified_time" content="2023-04-12T04:14:48.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"创建型工厂模式","image":[""],"datePublished":"2019-10-12T00:00:00.000Z","dateModified":"2023-04-12T04:14:48.000Z","author":[{"@type":"Person","name":"gavin-james","url":"http://www.gavin-james.xyz"}]}</script><meta name="baidu-site-verification" content="code-fLaULewlcT"><meta name="keywords" content="Gavin个人博客, VuePress搭建, 学习Java、Web、框架、微服务、工具、前端等相关知识, 记录生活和技术路程。"><title>创建型工厂模式 | Gavin blog</title><meta name="description" content="工厂模式概述 工厂模式很重要，后面的很多架构设计，都是工厂模式联合着其它设计模式使用。 一般情况下，工厂模式分为三种更加细分的类型：简单工厂、工厂方法和抽象工厂。不过，在 GOF 的《设计模式》一书中，它将简单工厂模式看作是工厂方法模式的一种特例，所以工厂模式只被分成了工厂方法和抽象工厂两类。实际上，前面一种分类方法更加常见，所以，在今天的讲解中，我们沿用第一种分类方法。 在这三种细分的工厂模式中，简单工厂、工厂方法原理比较简单，在实际的项目中也比较常用。而抽象工厂的原理稍微复杂点，在实际的项目中相对也不常用。">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-55b725f2.css" as="style"><link rel="stylesheet" href="/assets/style-55b725f2.css">
    <link rel="modulepreload" href="/assets/app-f100e154.js"><link rel="modulepreload" href="/assets/framework-6199cc12.js"><link rel="modulepreload" href="/assets/factory.html-136ab4cc.js"><link rel="modulepreload" href="/assets/factory.html-269739b8.js"><link rel="prefetch" href="/assets/index.html-e4c3e7cd.js" as="script"><link rel="prefetch" href="/assets/home.html-0727cce7.js" as="script"><link rel="prefetch" href="/assets/slide.html-80819350.js" as="script"><link rel="prefetch" href="/assets/index.html-6e78c42f.js" as="script"><link rel="prefetch" href="/assets/index.html-cf0d1f3f.js" as="script"><link rel="prefetch" href="/assets/index.html-307aa124.js" as="script"><link rel="prefetch" href="/assets/index.html-c0a90ad9.js" as="script"><link rel="prefetch" href="/assets/home.html-a40dd387.js" as="script"><link rel="prefetch" href="/assets/slide.html-1a28ad4d.js" as="script"><link rel="prefetch" href="/assets/index.html-6f2500e1.js" as="script"><link rel="prefetch" href="/assets/index.html-7701dc9d.js" as="script"><link rel="prefetch" href="/assets/index.html-a0d91d97.js" as="script"><link rel="prefetch" href="/assets/disable.html-bf1cd917.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-bc132a45.js" as="script"><link rel="prefetch" href="/assets/markdown.html-1dc46f3f.js" as="script"><link rel="prefetch" href="/assets/page.html-26ca9a2a.js" as="script"><link rel="prefetch" href="/assets/study.html-23205429.js" as="script"><link rel="prefetch" href="/assets/index.html-a6845732.js" as="script"><link rel="prefetch" href="/assets/index.html-3d614120.js" as="script"><link rel="prefetch" href="/assets/index.html-c04ffcb6.js" as="script"><link rel="prefetch" href="/assets/mermaid.html-c16cd2be.js" as="script"><link rel="prefetch" href="/assets/zuosi.html-e57b9acf.js" as="script"><link rel="prefetch" href="/assets/01.html-dab9c77a.js" as="script"><link rel="prefetch" href="/assets/01.html-034b4e08.js" as="script"><link rel="prefetch" href="/assets/algorithms.html-fe1c79ad.js" as="script"><link rel="prefetch" href="/assets/structures.html-2b536b45.js" as="script"><link rel="prefetch" href="/assets/adapter.html-366c7e4f.js" as="script"><link rel="prefetch" href="/assets/bridge.html-86d02546.js" as="script"><link rel="prefetch" href="/assets/builder.html-4f6294cd.js" as="script"><link rel="prefetch" href="/assets/command.html-b6cc73b9.js" as="script"><link rel="prefetch" href="/assets/composite.html-6ab4748e.js" as="script"><link rel="prefetch" href="/assets/decorator.html-aca775ad.js" as="script"><link rel="prefetch" href="/assets/end.html-ba6badb3.js" as="script"><link rel="prefetch" href="/assets/facade.html-7cd48c3c.js" as="script"><link rel="prefetch" href="/assets/flyweight.html-e29599de.js" as="script"><link rel="prefetch" href="/assets/interpreter.html-e4e1d88e.js" as="script"><link rel="prefetch" href="/assets/iterator.html-39f10805.js" as="script"><link rel="prefetch" href="/assets/mediator.html-323387c7.js" as="script"><link rel="prefetch" href="/assets/memento.html-aa3f7de2.js" as="script"><link rel="prefetch" href="/assets/observer.html-b6d44fe9.js" as="script"><link rel="prefetch" href="/assets/prototype.html-9081fc6d.js" as="script"><link rel="prefetch" href="/assets/proxy.html-182bc90b.js" as="script"><link rel="prefetch" href="/assets/responsibility.html-13a88066.js" as="script"><link rel="prefetch" href="/assets/seven-principles.html-6b22afad.js" as="script"><link rel="prefetch" href="/assets/single.html-188b58c2.js" as="script"><link rel="prefetch" href="/assets/state.html-14983c2e.js" as="script"><link rel="prefetch" href="/assets/strategy.html-d8634978.js" as="script"><link rel="prefetch" href="/assets/summary.html-a6093c2d.js" as="script"><link rel="prefetch" href="/assets/template-method.html-6036a343.js" as="script"><link rel="prefetch" href="/assets/thought.html-ea18c772.js" as="script"><link rel="prefetch" href="/assets/uml-class-diagram.html-a7d9f6c1.js" as="script"><link rel="prefetch" href="/assets/visitor.html-93a4843c.js" as="script"><link rel="prefetch" href="/assets/code-style-alibaba.html-73d858b4.js" as="script"><link rel="prefetch" href="/assets/01.html-8f24502a.js" as="script"><link rel="prefetch" href="/assets/404.html-181f0a2b.js" as="script"><link rel="prefetch" href="/assets/index.html-36d499bd.js" as="script"><link rel="prefetch" href="/assets/index.html-beef59ef.js" as="script"><link rel="prefetch" href="/assets/index.html-c0ee43fb.js" as="script"><link rel="prefetch" href="/assets/index.html-4ebc12e2.js" as="script"><link rel="prefetch" href="/assets/index.html-2ddf29b2.js" as="script"><link rel="prefetch" href="/assets/index.html-ac0d41e3.js" as="script"><link rel="prefetch" href="/assets/index.html-759993dc.js" as="script"><link rel="prefetch" href="/assets/index.html-a57724c9.js" as="script"><link rel="prefetch" href="/assets/index.html-2ee485fc.js" as="script"><link rel="prefetch" href="/assets/index.html-69f2dc65.js" as="script"><link rel="prefetch" href="/assets/index.html-a0ae78b8.js" as="script"><link rel="prefetch" href="/assets/index.html-d3ff89a4.js" as="script"><link rel="prefetch" href="/assets/index.html-37e68157.js" as="script"><link rel="prefetch" href="/assets/index.html-f8844ddf.js" as="script"><link rel="prefetch" href="/assets/index.html-62e2a04a.js" as="script"><link rel="prefetch" href="/assets/index.html-74fac820.js" as="script"><link rel="prefetch" href="/assets/index.html-53de8182.js" as="script"><link rel="prefetch" href="/assets/index.html-eade39a7.js" as="script"><link rel="prefetch" href="/assets/index.html-509cedb9.js" as="script"><link rel="prefetch" href="/assets/index.html-d1b03744.js" as="script"><link rel="prefetch" href="/assets/index.html-c52ae001.js" as="script"><link rel="prefetch" href="/assets/index.html-e04f4667.js" as="script"><link rel="prefetch" href="/assets/index.html-3ea07717.js" as="script"><link rel="prefetch" href="/assets/index.html-6d5f7283.js" as="script"><link rel="prefetch" href="/assets/index.html-b4d0ce61.js" as="script"><link rel="prefetch" href="/assets/index.html-d61b78ec.js" as="script"><link rel="prefetch" href="/assets/index.html-6a724f85.js" as="script"><link rel="prefetch" href="/assets/index.html-9f3cafc5.js" as="script"><link rel="prefetch" href="/assets/index.html-e5d174a4.js" as="script"><link rel="prefetch" href="/assets/home.html-15eee102.js" as="script"><link rel="prefetch" href="/assets/slide.html-eb5806bd.js" as="script"><link rel="prefetch" href="/assets/index.html-b082872c.js" as="script"><link rel="prefetch" href="/assets/index.html-0cd12836.js" as="script"><link rel="prefetch" href="/assets/index.html-cdaa127c.js" as="script"><link rel="prefetch" href="/assets/index.html-9813c222.js" as="script"><link rel="prefetch" href="/assets/home.html-b0752f99.js" as="script"><link rel="prefetch" href="/assets/slide.html-a80488d3.js" as="script"><link rel="prefetch" href="/assets/index.html-cb088d92.js" as="script"><link rel="prefetch" href="/assets/index.html-cdf8b1a2.js" as="script"><link rel="prefetch" href="/assets/index.html-c2bec5ff.js" as="script"><link rel="prefetch" href="/assets/disable.html-c443f8d2.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-cc4a33b4.js" as="script"><link rel="prefetch" href="/assets/markdown.html-990473a9.js" as="script"><link rel="prefetch" href="/assets/page.html-316783e3.js" as="script"><link rel="prefetch" href="/assets/study.html-db9ce95d.js" as="script"><link rel="prefetch" href="/assets/index.html-23dc37fe.js" as="script"><link rel="prefetch" href="/assets/index.html-afd1ce2d.js" as="script"><link rel="prefetch" href="/assets/index.html-b6e38aa9.js" as="script"><link rel="prefetch" href="/assets/mermaid.html-03c43c7e.js" as="script"><link rel="prefetch" href="/assets/zuosi.html-a518533b.js" as="script"><link rel="prefetch" href="/assets/01.html-c3d7cc50.js" as="script"><link rel="prefetch" href="/assets/01.html-29585f2f.js" as="script"><link rel="prefetch" href="/assets/algorithms.html-0f818a80.js" as="script"><link rel="prefetch" href="/assets/structures.html-2ec356ec.js" as="script"><link rel="prefetch" href="/assets/adapter.html-7f3e4c47.js" as="script"><link rel="prefetch" href="/assets/bridge.html-70ea3345.js" as="script"><link rel="prefetch" href="/assets/builder.html-49129ecd.js" as="script"><link rel="prefetch" href="/assets/command.html-644f703d.js" as="script"><link rel="prefetch" href="/assets/composite.html-c7587480.js" as="script"><link rel="prefetch" href="/assets/decorator.html-15c2c152.js" as="script"><link rel="prefetch" href="/assets/end.html-b4d477de.js" as="script"><link rel="prefetch" href="/assets/facade.html-56db0c3c.js" as="script"><link rel="prefetch" href="/assets/flyweight.html-53b06206.js" as="script"><link rel="prefetch" href="/assets/interpreter.html-a4311e3b.js" as="script"><link rel="prefetch" href="/assets/iterator.html-1646e2bd.js" as="script"><link rel="prefetch" href="/assets/mediator.html-a849ed90.js" as="script"><link rel="prefetch" href="/assets/memento.html-b8163bfa.js" as="script"><link rel="prefetch" href="/assets/observer.html-8708db99.js" as="script"><link rel="prefetch" href="/assets/prototype.html-20995757.js" as="script"><link rel="prefetch" href="/assets/proxy.html-d60f4ecb.js" as="script"><link rel="prefetch" href="/assets/responsibility.html-ea0c1e58.js" as="script"><link rel="prefetch" href="/assets/seven-principles.html-9992f401.js" as="script"><link rel="prefetch" href="/assets/single.html-c720c1e1.js" as="script"><link rel="prefetch" href="/assets/state.html-a2c36b34.js" as="script"><link rel="prefetch" href="/assets/strategy.html-13e4db90.js" as="script"><link rel="prefetch" href="/assets/summary.html-408b065f.js" as="script"><link rel="prefetch" href="/assets/template-method.html-e7b75428.js" as="script"><link rel="prefetch" href="/assets/thought.html-9e03cdf2.js" as="script"><link rel="prefetch" href="/assets/uml-class-diagram.html-cc76b846.js" as="script"><link rel="prefetch" href="/assets/visitor.html-b4e5b105.js" as="script"><link rel="prefetch" href="/assets/code-style-alibaba.html-c7209708.js" as="script"><link rel="prefetch" href="/assets/01.html-decd7acf.js" as="script"><link rel="prefetch" href="/assets/404.html-f64a78a2.js" as="script"><link rel="prefetch" href="/assets/index.html-f628608c.js" as="script"><link rel="prefetch" href="/assets/index.html-5d9de8b7.js" as="script"><link rel="prefetch" href="/assets/index.html-4d208221.js" as="script"><link rel="prefetch" href="/assets/index.html-2102025c.js" as="script"><link rel="prefetch" href="/assets/index.html-01d25bfb.js" as="script"><link rel="prefetch" href="/assets/index.html-0261da9b.js" as="script"><link rel="prefetch" href="/assets/index.html-50b21a30.js" as="script"><link rel="prefetch" href="/assets/index.html-3bab9cf9.js" as="script"><link rel="prefetch" href="/assets/index.html-44186742.js" as="script"><link rel="prefetch" href="/assets/index.html-841ebb56.js" as="script"><link rel="prefetch" href="/assets/index.html-6bd804d9.js" as="script"><link rel="prefetch" href="/assets/index.html-fd25f31b.js" as="script"><link rel="prefetch" href="/assets/index.html-2a47c47e.js" as="script"><link rel="prefetch" href="/assets/index.html-ec53999d.js" as="script"><link rel="prefetch" href="/assets/index.html-c20040e9.js" as="script"><link rel="prefetch" href="/assets/index.html-38a011b3.js" as="script"><link rel="prefetch" href="/assets/index.html-bcfc1efb.js" as="script"><link rel="prefetch" href="/assets/index.html-f23ccc76.js" as="script"><link rel="prefetch" href="/assets/index.html-2442a31b.js" as="script"><link rel="prefetch" href="/assets/index.html-6d0c5e78.js" as="script"><link rel="prefetch" href="/assets/index.html-2b15a927.js" as="script"><link rel="prefetch" href="/assets/index.html-c793c899.js" as="script"><link rel="prefetch" href="/assets/index.html-a31e0ea1.js" as="script"><link rel="prefetch" href="/assets/index.html-f5af1768.js" as="script"><link rel="prefetch" href="/assets/index.html-44d71285.js" as="script"><link rel="prefetch" href="/assets/index.html-11f29a53.js" as="script"><link rel="prefetch" href="/assets/index.html-b8539534.js" as="script"><link rel="prefetch" href="/assets/index.html-1bb477e1.js" as="script"><link rel="prefetch" href="/assets/twikoo.all.min-abbda402.js" as="script"><link rel="prefetch" href="/assets/auto-ba5ecab5.js" as="script"><link rel="prefetch" href="/assets/index-b03bef79.js" as="script"><link rel="prefetch" href="/assets/flowchart-35969cab.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-27610b2c.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-a794bb63.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-224f94d9.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-e5069ce0.js" as="script"><link rel="prefetch" href="/assets/search.esm-2c3fba7d.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-b2b4b103.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-36cd6c3c.js" as="script"><link rel="prefetch" href="/assets/SearchResult-2a1c4a89.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Gavin blog"><!----><span class="site-name hide-in-pad">Gavin blog</span></a><!--]--><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!--[--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="首页"><span class="font-icon icon iconfont icon-homepage" style=""></span>首页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/resource/" class="nav-link" aria-label="导航"><span class="font-icon icon iconfont icon-manage_fill" style=""></span>导航<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Java"><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>java基础</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/base/01.html" class="nav-link" aria-label="java-基础"><span class="font-icon icon iconfont icon-edit" style=""></span>java-基础<!----></a></li><li class="dropdown-subitem"><a href="/Java/base/01.html" class="nav-link" aria-label="java-集合"><span class="font-icon icon iconfont icon-edit" style=""></span>java-集合<!----></a></li><li class="dropdown-subitem"><a href="/Java/base/01.html" class="nav-link" aria-label="java-并发"><span class="font-icon icon iconfont icon-edit" style=""></span>java-并发<!----></a></li><li class="dropdown-subitem"><a href="/Java/base/01.html" class="nav-link" aria-label="java-IO"><span class="font-icon icon iconfont icon-IO" style=""></span>java-IO<!----></a></li><li class="dropdown-subitem"><a href="/Java/base/01.html" class="nav-link" aria-label="java-新特性"><span class="font-icon icon iconfont icon-edit" style=""></span>java-新特性<!----></a></li><li class="dropdown-subitem"><a href="/Java/base/01.html" class="nav-link" aria-label="java-JVM"><span class="font-icon icon iconfont icon-edit" style=""></span>java-JVM<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring生态</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Java/spring/01.html" class="nav-link" aria-label="Spring-Framework"><!---->Spring-Framework<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="数据库"><span class="title"><span class="font-icon icon iconfont icon-database" style=""></span>数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>数据库基础和原理</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/design/thoughtstructures.md" class="nav-link" aria-label="数据库原理"><!---->数据库原理<!----></a></li><li class="dropdown-subitem"><a href="/database/design/thoughtalgorithms.md" class="nav-link" aria-label="SQL语言"><!---->SQL语言<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>SQL数据库</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/algorithms-structures/structures.md" class="nav-link" aria-label="MySQL"><span class="font-icon icon iconfont icon-mysql" style=""></span>MySQL<!----></a></li><li class="dropdown-subitem"><a href="/database/algorithms-structures/algorithms.md" class="nav-link" aria-label="Oracle"><span class="font-icon icon iconfont icon-oracle" style=""></span>Oracle<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>NOSQL数据库</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/algorithms-structures/structures.md" class="nav-link" aria-label="Redis"><span class="font-icon icon iconfont icon-redis" style=""></span>Redis<!----></a></li><li class="dropdown-subitem"><a href="/database/algorithms-structures/algorithms.md" class="nav-link" aria-label="MongoDB"><span class="font-icon icon iconfont icon-mongodb" style=""></span>MongoDB<!----></a></li><li class="dropdown-subitem"><a href="/database/algorithms-structures/algorithms.md" class="nav-link" aria-label="ElasticSearch"><span class="font-icon icon iconfont icon-elasticsearch" style=""></span>ElasticSearch<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="开发"><span class="title"><span class="font-icon icon iconfont icon-code" style=""></span>开发</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><a href="/develop/design/thought.html" class="nav-link" aria-label="设计思想"><!---->设计思想<!----></a></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="开发原则(SOLID)"><!---->开发原则(SOLID)<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="分布式理论(CAP)"><!---->分布式理论(CAP)<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="分布式理论(BASE)"><!---->分布式理论(BASE)<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="事务理论(ACID)"><!---->事务理论(ACID)<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="微服务基础(康威定律)"><!---->微服务基础(康威定律)<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="常用类详解"><!---->常用类详解<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="正则表达式"><!---->正则表达式<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="CRON表达式"><!---->CRON表达式<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="网络协议和工具"><!---->网络协议和工具<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="安全相关"><!---->安全相关<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><a href="/develop/design/thought.html" class="nav-link" aria-label="设计思想"><!---->设计思想<!----></a></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="软件生命周期与传统模式"><!---->软件生命周期与传统模式<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="结合测试演化的过程模型"><!---->结合测试演化的过程模型<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="敏捷开发项目管理理论"><!---->敏捷开发项目管理理论<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="敏捷之极限编程(XP)"><!---->敏捷之极限编程(XP)<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="敏捷之Scrum &amp; Kanban"><!---->敏捷之Scrum &amp; Kanban<!----></a></li><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="敏捷实践之测试驱动开发"><!---->敏捷实践之测试驱动开发<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>质量保障</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/develop/quality-assurance/structures.md" class="nav-link" aria-label="单元测试"><!---->单元测试<!----></a></li><li class="dropdown-subitem"><a href="/develop/quality-assurance/structures.md" class="nav-link" aria-label="统一风格"><!---->统一风格<!----></a></li><li class="dropdown-subitem"><a href="/develop/quality-assurance/structures.md" class="nav-link" aria-label="质量管理"><!---->质量管理<!----></a></li><li class="dropdown-subitem"><a href="/develop/quality-assurance/code-style-alibaba.html" class="nav-link" aria-label="阿里巴巴 Java 开发手册"><!---->阿里巴巴 Java 开发手册<!----></a></li><li class="dropdown-subitem"><a href="/develop/quality-assurance/structures.md" class="nav-link" aria-label="Google Java 编程风格指南"><!---->Google Java 编程风格指南<!----></a></li><li class="dropdown-subitem"><a href="/develop/quality-assurance/structures.md" class="nav-link" aria-label="Twitter Java Style Guide"><!---->Twitter Java Style Guide<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><a href="/develop/design/thought.html" class="nav-link" aria-label="设计思想"><!---->设计思想<!----></a></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="重构技巧相关"><!---->重构技巧相关<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><a href="/develop/design/thought.html" class="nav-link" aria-label="设计思想"><!---->设计思想<!----></a></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/develop/structures.md" class="nav-link" aria-label="设计模式详解"><!---->设计模式详解<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>算法和数据结构</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/develop/algorithms-structures/structures.html" class="nav-link" aria-label="数据结构"><!---->数据结构<!----></a></li><li class="dropdown-subitem"><a href="/develop/algorithms-structures/algorithms.html" class="nav-link" aria-label="算法"><!---->算法<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>开源协议</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/develop/algorithms-structures/structures.html" class="nav-link" aria-label="常见软件开源协议详解"><!---->常见软件开源协议详解<!----></a></li><li class="dropdown-subitem"><a href="/develop/algorithms-structures/structures.html" class="nav-link" aria-label="知识共享许可协议"><!---->知识共享许可协议<!----></a></li><li class="dropdown-subitem"><a href="/develop/algorithms-structures/structures.html" class="nav-link" aria-label="国产开源木兰协议"><!---->国产开源木兰协议<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>系统认证</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/develop/algorithms-structures/structures.html" class="nav-link" aria-label="CMMI 认证"><!---->CMMI 认证<!----></a></li><li class="dropdown-subitem"><a href="/develop/algorithms-structures/structures.html" class="nav-link" aria-label="等级保护认证"><!---->等级保护认证<!----></a></li><li class="dropdown-subitem"><a href="/develop/algorithms-structures/structures.html" class="nav-link" aria-label="ISO27001认证"><!---->ISO27001认证<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="框架"><span class="title"><span class="font-icon icon iconfont icon-generic" style=""></span>框架</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>管理</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/base/01.md" class="nav-link" aria-label="Git"><span class="font-icon icon iconfont icon-edit" style=""></span>Git<!----></a></li><li class="dropdown-subitem"><a href="/framework/base/01.md" class="nav-link" aria-label="Maven"><span class="font-icon icon iconfont icon-edit" style=""></span>Maven<!----></a></li><li class="dropdown-subitem"><a href="/framework/base/01.md" class="nav-link" aria-label="Gradle"><span class="font-icon icon iconfont icon-edit" style=""></span>Gradle<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>部署</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/spring/01.md" class="nav-link" aria-label="Linux"><!---->Linux<!----></a></li><li class="dropdown-subitem"><a href="/framework/docker/01.md" class="nav-link" aria-label="Docker"><!---->Docker<!----></a></li><li class="dropdown-subitem"><a href="/framework/spring/01.md" class="nav-link" aria-label="Jenkins"><!---->Jenkins<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="架构"><span class="title"><span class="font-icon icon iconfont icon-generic" style=""></span>架构</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>管理</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/base/01.md" class="nav-link" aria-label="Git"><span class="font-icon icon iconfont icon-edit" style=""></span>Git<!----></a></li><li class="dropdown-subitem"><a href="/framework/base/01.md" class="nav-link" aria-label="Maven"><span class="font-icon icon iconfont icon-edit" style=""></span>Maven<!----></a></li><li class="dropdown-subitem"><a href="/framework/base/01.md" class="nav-link" aria-label="Gradle"><span class="font-icon icon iconfont icon-edit" style=""></span>Gradle<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>部署</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/spring/01.md" class="nav-link" aria-label="Linux"><!---->Linux<!----></a></li><li class="dropdown-subitem"><a href="/framework/docker/01.md" class="nav-link" aria-label="Docker"><!---->Docker<!----></a></li><li class="dropdown-subitem"><a href="/framework/spring/01.md" class="nav-link" aria-label="Jenkins"><!---->Jenkins<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="工具"><span class="title"><span class="font-icon icon iconfont icon-tool" style=""></span>工具</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>管理</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tool/base/01.md" class="nav-link" aria-label="Git"><span class="font-icon icon iconfont icon-edit" style=""></span>Git<!----></a></li><li class="dropdown-subitem"><a href="/tool/base/01.md" class="nav-link" aria-label="Maven"><span class="font-icon icon iconfont icon-edit" style=""></span>Maven<!----></a></li><li class="dropdown-subitem"><a href="/tool/base/01.md" class="nav-link" aria-label="Gradle"><span class="font-icon icon iconfont icon-edit" style=""></span>Gradle<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>部署</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tool/spring/01.md" class="nav-link" aria-label="Linux"><!---->Linux<!----></a></li><li class="dropdown-subitem"><a href="/tool/docker/01.html" class="nav-link" aria-label="Docker"><!---->Docker<!----></a></li><li class="dropdown-subitem"><a href="/tool/spring/01.md" class="nav-link" aria-label="Jenkins"><!---->Jenkins<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="前端"><span class="title"><span class="font-icon icon iconfont icon-template" style=""></span>前端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>管理</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/base/01.md" class="nav-link" aria-label="Git"><span class="font-icon icon iconfont icon-edit" style=""></span>Git<!----></a></li><li class="dropdown-subitem"><a href="/front/base/01.md" class="nav-link" aria-label="Maven"><span class="font-icon icon iconfont icon-edit" style=""></span>Maven<!----></a></li><li class="dropdown-subitem"><a href="/front/base/01.md" class="nav-link" aria-label="Gradle"><span class="font-icon icon iconfont icon-edit" style=""></span>Gradle<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>部署</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front/spring/01.md" class="nav-link" aria-label="Linux"><!---->Linux<!----></a></li><li class="dropdown-subitem"><a href="/front/docker/01.md" class="nav-link" aria-label="Docker"><!---->Docker<!----></a></li><li class="dropdown-subitem"><a href="/front/spring/01.md" class="nav-link" aria-label="Jenkins"><!---->Jenkins<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="更多"><span class="title"><span class="font-icon icon iconfont icon-more" style=""></span>更多</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>管理</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/more/base/01.md" class="nav-link" aria-label="Git"><span class="font-icon icon iconfont icon-edit" style=""></span>Git<!----></a></li><li class="dropdown-subitem"><a href="/more/base/01.md" class="nav-link" aria-label="Maven"><span class="font-icon icon iconfont icon-edit" style=""></span>Maven<!----></a></li><li class="dropdown-subitem"><a href="/more/base/01.md" class="nav-link" aria-label="Gradle"><span class="font-icon icon iconfont icon-edit" style=""></span>Gradle<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>部署</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/more/spring/01.md" class="nav-link" aria-label="Linux"><!---->Linux<!----></a></li><li class="dropdown-subitem"><a href="/more/docker/01.md" class="nav-link" aria-label="Docker"><!---->Docker<!----></a></li><li class="dropdown-subitem"><a href="/more/spring/01.md" class="nav-link" aria-label="Jenkins"><!---->Jenkins<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="关于"><span class="title"><span class="font-icon icon iconfont icon-people" style=""></span>关于</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>管理</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/base/01.md" class="nav-link" aria-label="Git"><span class="font-icon icon iconfont icon-edit" style=""></span>Git<!----></a></li><li class="dropdown-subitem"><a href="/about/base/01.md" class="nav-link" aria-label="Maven"><span class="font-icon icon iconfont icon-edit" style=""></span>Maven<!----></a></li><li class="dropdown-subitem"><a href="/about/base/01.md" class="nav-link" aria-label="Gradle"><span class="font-icon icon iconfont icon-edit" style=""></span>Gradle<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>部署</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/spring/01.md" class="nav-link" aria-label="Linux"><!---->Linux<!----></a></li><li class="dropdown-subitem"><a href="/about/docker/01.md" class="nav-link" aria-label="Docker"><!---->Docker<!----></a></li><li class="dropdown-subitem"><a href="/about/spring/01.md" class="nav-link" aria-label="Jenkins"><!---->Jenkins<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!--[--><div class="nav-item"><div class="dropdown-wrapper i18n-dropdown"><button type="button" class="dropdown-title" aria-label="选择语言"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-current="page" href="/develop/design/factory.html" class="router-link-active router-link-exact-active nav-link active" aria-label="简体中文"><!---->简体中文<!----></a></li><li class="dropdown-item"><a href="/en/" class="nav-link" aria-label="English"><!---->English<!----></a></li></ul></button></div></div><div class="nav-item"><a class="repo-link" href="https://github.com/gavin-james/gavin-james.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">搜索</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><!----><span class="title">设计模式</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/develop/design/thought.html" class="nav-link sidebar-link sidebar-page" aria-label="设计思想"><!---->设计思想<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/develop/design/seven-principles.html" class="nav-link sidebar-link sidebar-page" aria-label="七大原则"><!---->七大原则<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/develop/design/uml-class-diagram.html" class="nav-link sidebar-link sidebar-page" aria-label="UML类图"><!---->UML类图<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/develop/design/summary.html" class="nav-link sidebar-link sidebar-page" aria-label="设计模式概述"><!---->设计模式概述<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><!----><span class="title">创建型模式</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/develop/design/single.html" class="nav-link sidebar-link sidebar-page" aria-label="创建型单例模式"><!---->创建型单例模式<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/develop/design/factory.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="创建型工厂模式"><!---->创建型工厂模式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#工厂模式概述" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="工厂模式概述"><!---->工厂模式概述<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#简单工厂-simple-factory" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="简单工厂（Simple Factory）"><!---->简单工厂（Simple Factory）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#简单工厂模式基本介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="简单工厂模式基本介绍"><!---->简单工厂模式基本介绍<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#传统方式完成披萨案例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="传统方式完成披萨案例"><!---->传统方式完成披萨案例<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#简单工厂模式完成案例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="简单工厂模式完成案例"><!---->简单工厂模式完成案例<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#工厂方法-factory-method" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="工厂方法（Factory Method）"><!---->工厂方法（Factory Method）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#工厂方法模式介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="工厂方法模式介绍"><!---->工厂方法模式介绍<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#工厂方法模式完成案例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="工厂方法模式完成案例"><!---->工厂方法模式完成案例<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#什么时候该用工厂方法模式-而非简单工厂模式呢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="什么时候该用工厂方法模式，而非简单工厂模式呢？"><!---->什么时候该用工厂方法模式，而非简单工厂模式呢？<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#抽象工厂-abstract-factory" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="抽象工厂（Abstract Factory）"><!---->抽象工厂（Abstract Factory）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#基本介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="基本介绍"><!---->基本介绍<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#抽象工厂模式应用实例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="抽象工厂模式应用实例"><!---->抽象工厂模式应用实例<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#工厂模式在-jdk-calendar-应用的源码分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="工厂模式在 JDK-Calendar 应用的源码分析"><!---->工厂模式在 JDK-Calendar 应用的源码分析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#工厂模式小结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="工厂模式小结"><!---->工厂模式小结<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#如何设计实现一个dependency-injection框架" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="如何设计实现一个Dependency Injection框架"><!---->如何设计实现一个Dependency Injection框架<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#工厂模式和-di-容器有何区别" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="工厂模式和 DI 容器有何区别"><!---->工厂模式和 DI 容器有何区别<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#di-容器的核心功能有哪些" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="DI 容器的核心功能有哪些"><!---->DI 容器的核心功能有哪些<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#如何实现一个简单的-di-容器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="如何实现一个简单的 DI 容器？"><!---->如何实现一个简单的 DI 容器？<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#最小原型设计" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="最小原型设计"><!---->最小原型设计<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#提供执行入口" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="提供执行入口"><!---->提供执行入口<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#配置文件解析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="配置文件解析"><!---->配置文件解析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/develop/design/factory.html#核心工厂类设计" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="核心工厂类设计"><!---->核心工厂类设计<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/develop/design/prototype.html" class="nav-link sidebar-link sidebar-page" aria-label="创建型原型模式"><!---->创建型原型模式<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/develop/design/builder.html" class="nav-link sidebar-link sidebar-page" aria-label="创建型建造者模式"><!---->创建型建造者模式<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">结构型模式</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">行为型模式</span><span class="arrow end"></span></button><!----></section></li><li><!--[--><a href="/develop/design/end.html" class="nav-link sidebar-link sidebar-page" aria-label="设计模式总结"><!---->设计模式总结<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">算法和数据结构</span><span class="arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->创建型工厂模式</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="http://www.gavin-james.xyz" target="_blank" rel="noopener noreferrer">gavin-james</a></span><span property="author" content="gavin-james"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2019-10-12T00:00:00.000Z"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category2 clickable" role="navigation">设计模式</span><!--]--><meta property="articleSection" content="设计模式"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag2 clickable" role="navigation">设计模式</span><!--]--><meta property="keywords" content="设计模式"></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 27 分钟</span><meta property="timeRequired" content="PT27M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#工厂模式概述" class="router-link-active router-link-exact-active toc-link level2">工厂模式概述</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#简单工厂-simple-factory" class="router-link-active router-link-exact-active toc-link level2">简单工厂（Simple Factory）</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#简单工厂模式基本介绍" class="router-link-active router-link-exact-active toc-link level3">简单工厂模式基本介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#传统方式完成披萨案例" class="router-link-active router-link-exact-active toc-link level3">传统方式完成披萨案例</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#简单工厂模式完成案例" class="router-link-active router-link-exact-active toc-link level3">简单工厂模式完成案例</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#工厂方法-factory-method" class="router-link-active router-link-exact-active toc-link level2">工厂方法（Factory Method）</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#工厂方法模式介绍" class="router-link-active router-link-exact-active toc-link level3">工厂方法模式介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#工厂方法模式完成案例" class="router-link-active router-link-exact-active toc-link level3">工厂方法模式完成案例</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#什么时候该用工厂方法模式-而非简单工厂模式呢" class="router-link-active router-link-exact-active toc-link level3">什么时候该用工厂方法模式，而非简单工厂模式呢？</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#抽象工厂-abstract-factory" class="router-link-active router-link-exact-active toc-link level2">抽象工厂（Abstract Factory）</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#基本介绍" class="router-link-active router-link-exact-active toc-link level3">基本介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#抽象工厂模式应用实例" class="router-link-active router-link-exact-active toc-link level3">抽象工厂模式应用实例</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#工厂模式在-jdk-calendar-应用的源码分析" class="router-link-active router-link-exact-active toc-link level2">工厂模式在 JDK-Calendar 应用的源码分析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#工厂模式小结" class="router-link-active router-link-exact-active toc-link level2">工厂模式小结</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#如何设计实现一个dependency-injection框架" class="router-link-active router-link-exact-active toc-link level2">如何设计实现一个Dependency Injection框架</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#工厂模式和-di-容器有何区别" class="router-link-active router-link-exact-active toc-link level3">工厂模式和 DI 容器有何区别</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#di-容器的核心功能有哪些" class="router-link-active router-link-exact-active toc-link level3">DI 容器的核心功能有哪些</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#如何实现一个简单的-di-容器" class="router-link-active router-link-exact-active toc-link level2">如何实现一个简单的 DI 容器？</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#最小原型设计" class="router-link-active router-link-exact-active toc-link level3">最小原型设计</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#提供执行入口" class="router-link-active router-link-exact-active toc-link level3">提供执行入口</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#配置文件解析" class="router-link-active router-link-exact-active toc-link level3">配置文件解析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/develop/design/factory.html#核心工厂类设计" class="router-link-active router-link-exact-active toc-link level3">核心工厂类设计</a></li><!----><!--]--></ul></li><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="工厂模式概述" tabindex="-1"><a class="header-anchor" href="#工厂模式概述" aria-hidden="true">#</a> 工厂模式概述</h2><blockquote><p>工厂模式很重要，后面的很多架构设计，都是工厂模式联合着其它设计模式使用。</p></blockquote><p>一般情况下，工厂模式分为三种更加细分的类型：简单工厂、工厂方法和抽象工厂。不过，在 GOF 的《设计模式》一书中，它将简单工厂模式看作是工厂方法模式的一种特例，所以工厂模式只被分成了工厂方法和抽象工厂两类。实际上，前面一种分类方法更加常见，所以，在今天的讲解中，我们沿用第一种分类方法。</p><p>在这三种细分的工厂模式中，简单工厂、工厂方法原理比较简单，在实际的项目中也比较常用。而抽象工厂的原理稍微复杂点，在实际的项目中相对也不常用。</p><p>除此之外，本内容讲解的重点也不是原理和实现，因为这些都很简单，重点还是要搞清楚应用场景：什么时候该用工厂模式？相对于直接 new 来创建对象，用工厂模式来创建究竟有什么好处呢？</p><p>简单工厂模式</p><ul><li>用来生产同一等级结构中的任意产品（对于增加新的产品，需要覆盖已有代码）</li></ul><p>工厂方法模式</p><ul><li>用来生产同一等级结构中的固定产品（支持增加任意产品）</li></ul><p>抽象工厂模式</p><ul><li>围绕一个超级工厂创建其他工厂，该超级工厂又称为其他工厂的工厂</li></ul><h2 id="简单工厂-simple-factory" tabindex="-1"><a class="header-anchor" href="#简单工厂-simple-factory" aria-hidden="true">#</a> 简单工厂（Simple Factory）</h2><h3 id="简单工厂模式基本介绍" tabindex="-1"><a class="header-anchor" href="#简单工厂模式基本介绍" aria-hidden="true">#</a> 简单工厂模式基本介绍</h3><p>简单工厂模式是属于 <strong>创建型模式</strong>，是工厂模式的一种。<strong>简单工厂模式是由一个工厂对象决定创建出哪一种产品类的实例</strong>。简单工厂模式是 <strong>工厂模式家族</strong> 中最简单实用的模式。</p><p><strong>简单工厂模式</strong>：定义了一个创建对象的类，由这个类来封装实例化对象的行为（代码）。</p><p>在简单工厂模式中创建实例的方法通常为静态（static）方法，因此 <strong>简单工厂模式</strong>（Simple Factory Pattern）又叫作 <strong>静态工厂方法模式</strong>（Static Factory Method Pattern）。</p><p>在软件开发中，当我们会用到大量的创建某种、某类或者某批对象时，就会使用到工厂模式。</p><blockquote><p>主要优点</p></blockquote><ul><li><p>工厂类包含必要的逻辑判断，可以决定在什么时候创建哪一个产品的实例。客户端可以免除直接创建产品对象的职责，很方便的创建出相应的产品。工厂和产品的职责区分明确</p></li><li><p>客户端无需知道所创建具体产品的类名，只需知道参数即可</p></li><li><p>也可以引入配置文件，在不修改客户端代码的情况下更换和添加新的具体产品类</p></li></ul><blockquote><p>主要缺点</p></blockquote><ul><li>简单工厂模式的工厂类单一，负责所有产品的创建，职责过重，一旦异常，整个系统将受影响。且工厂类代码会非常臃肿，违背高聚合原则</li><li>使用简单工厂模式会增加系统中类的个数（引入新的工厂类），增加系统的复杂度和理解难度</li><li>系统扩展困难，一旦增加新产品不得不修改工厂逻辑，在产品类型较多时，可能造成逻辑过于复杂</li><li>简单工厂模式使用了 static 工厂方法，造成工厂角色无法形成基于继承的等级结构</li></ul><blockquote><p>主要角色</p></blockquote><ul><li>简单工厂（SimpleFactory）：是简单工厂模式的核心，负责实现创建所有实例的内部逻辑。工厂类的创建产品类的方法可以被外界直接调用，创建所需的产品对象</li><li>抽象产品（Product）：是简单工厂创建的所有对象的父类，负责描述所有实例共有的公共接口</li><li>具体产品（ConcreteProduct）：是简单工厂模式的创建目标</li></ul><blockquote><p>结构图</p></blockquote><figure><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/design-pattern/20220326223626.png" alt="image-20220326223625612" tabindex="0" loading="lazy"><figcaption>image-20220326223625612</figcaption></figure><h3 id="传统方式完成披萨案例" tabindex="-1"><a class="header-anchor" href="#传统方式完成披萨案例" aria-hidden="true">#</a> 传统方式完成披萨案例</h3><p>看一个披萨的项目：要便于披萨种类的扩展，要便于维护</p><ul><li>披萨的种类很多（比如 GreekPizz、CheesePizz 等）</li><li>披萨的制作有 prepare，bake, cut, box</li><li>完成披萨店订购功能</li></ul><p>思路分析（类图）</p><figure><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/design-pattern/20220227134536.png" alt="image-20220227134528102" tabindex="0" loading="lazy"><figcaption>image-20220227134528102</figcaption></figure><p>编写制作披萨的过程类 Pizza.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Pizza</span> <span class="token punctuation">{</span>
	<span class="token keyword">protected</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span> <span class="token comment">// 名字</span>

	<span class="token comment">// 准备原材料, 不同的披萨不一样，因此，我们做成抽象方法</span>
	<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 省略 setter、getter 方法</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">CheesePizza</span> <span class="token keyword">extends</span> <span class="token class-name">Pizza</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; 给制作奶酪披萨 准备原材料 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">GreekPizza</span> <span class="token keyword">extends</span> <span class="token class-name">Pizza</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; 给希腊披萨 准备原材料 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写 OrderPizza.java 去订购需要的各种披萨</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderPizza</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CheesePizza</span> cheesePizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CheesePizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">GreekPizza</span> greekPizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GreekPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cheesePizza<span class="token punctuation">.</span>getName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>greekPizza<span class="token punctuation">.</span>getName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要什么类型的披萨，new 出该对象。</p><blockquote><p>传统的方式的优缺点</p></blockquote><ul><li>优点是比较好理解，简单易操作</li><li>缺点是依赖性太强，不应该直接去 new 一个类</li></ul><blockquote><p>改进的思路分析</p></blockquote><p>分析：修改代码可以接受，但是如果我们在其它的地方也有创建 Pizza 的代码，就意味着，也需要修改，而创建 Pizza 的代码，往往有多处。</p><p>思路：把创建 Pizza 对象封装到一个类中，这样我们有新的 Pizza 种类时，只需要修改该类就可，其它有创建到 Pizza 对象的代码就不需要修改了，即 <strong>简单工厂模式</strong>。</p><h3 id="简单工厂模式完成案例" tabindex="-1"><a class="header-anchor" href="#简单工厂模式完成案例" aria-hidden="true">#</a> 简单工厂模式完成案例</h3><p>简单工厂模式的设计方案: 定义一个可以实例化 Pizaa 对象的类，封装创建对象的代码。</p><figure><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/design-pattern/20220227140037.png" alt="image-20220227140036784" tabindex="0" loading="lazy"><figcaption>image-20220227140036784</figcaption></figure><p>Pizza 类代码保持不变（上面有）。</p><p>简单工厂模式代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleFactory</span> <span class="token punctuation">{</span>

	<span class="token comment">// 方法一：if-else，缺点，违反了 OCP 原则</span>
	<span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">createPizza</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderType<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;使用简单工厂模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>orderType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;greek&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GreekPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			pizza<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot; 希腊披萨 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>orderType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;cheese&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CheesePizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			pizza<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot; 奶酪披萨 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> pizza<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

    <span class="token comment">// 方法二：利用方法代替 if-else，虽然也违反了 OCP 原则，但是为了迎合 OCP 原则，会花费大量的代价</span>
    <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">getGreekPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GreekPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pizza<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot; 希腊披萨 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> pizza<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Pizza</span> <span class="token function">getCheesePizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CheesePizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pizza<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot; 奶酪披萨 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> pizza<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">// 简单工厂模式 也叫 静态工厂模式（全部替换成 static 即可）</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Pizza</span> <span class="token function">createPizza2</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderType<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;使用简单工厂模式2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>orderType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;greek&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GreekPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			pizza<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot; 希腊披萨 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>orderType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;cheese&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CheesePizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			pizza<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot; 奶酪披萨 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">return</span> pizza<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时的 <code>OrderPizza.java</code> 文件也要修改：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderPizza</span> <span class="token punctuation">{</span>
    
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SimpleFactory</span> simpleFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> simpleFactory<span class="token punctuation">.</span><span class="token function">createPizza</span><span class="token punctuation">(</span><span class="token string">&quot;greek&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Pizza pizza = SimpleFactory.createPizza(&quot;greek&quot;); // 静态工厂模式</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pizza<span class="token punctuation">.</span>getName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>简单工厂模式虽然违反了 OCP 原则，但是花费的代价非常小，所以经常被使用。</p><h2 id="工厂方法-factory-method" tabindex="-1"><a class="header-anchor" href="#工厂方法-factory-method" aria-hidden="true">#</a> 工厂方法（Factory Method）</h2><h3 id="工厂方法模式介绍" tabindex="-1"><a class="header-anchor" href="#工厂方法模式介绍" aria-hidden="true">#</a> 工厂方法模式介绍</h3><p><strong>工厂方法模式</strong> 是对简单工厂模式的进一步抽象化，其好处是可以使系统在不修改原来代码的情况下引进新的产品，即满足开闭原则。</p><blockquote><p>主要优点</p></blockquote><ul><li>用户只需要知道具体工厂的名称就可得到所要的产品，无须知道产品的具体创建过程</li><li>灵活性增强，对于新产品的创建，只需多写一个相应的工厂类</li><li>典型的解耦框架。高层模块只需要知道产品的抽象类，无须关心其他实现类，满足迪米特法则、依赖倒置原则和里氏替换原则</li></ul><blockquote><p>主要缺点</p></blockquote><ul><li>类的个数容易过多，增加复杂度</li><li>增加了系统的抽象性和理解难度</li><li>抽象产品只能生产一种产品，此弊端可使用 <a href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82-abstract-factory">抽象工厂模式</a> 解决</li></ul><p>工厂方法模式：<strong>定义了一个创建对象的抽象方法</strong>，由 <strong>子类决定要实例化的类</strong>。工厂方法模式将 <strong>对象的实例化推迟到子类</strong>。</p><blockquote><p>主要角色</p></blockquote><ul><li>抽象工厂（Abstract Factory）：提供了创建产品的接口，调用者通过它访问具体工厂的工厂方法 newProduct() 来创建产品</li><li>具体工厂（ConcreteFactory）：主要是实现抽象工厂中的抽象方法，完成具体产品的创建</li><li>抽象产品（Product）：定义了产品的规范，描述了产品的主要特性和功能</li><li>具体产品（ConcreteProduct）：实现了抽象产品角色所定义的接口，由具体工厂来创建，它同具体工厂之间一一对应</li></ul><p>其结构图如下所示：</p><figure><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/design-pattern/20220326222948.png" alt="image-20220326222947461" tabindex="0" loading="lazy"><figcaption>image-20220326222947461</figcaption></figure><h3 id="工厂方法模式完成案例" tabindex="-1"><a class="header-anchor" href="#工厂方法模式完成案例" aria-hidden="true">#</a> 工厂方法模式完成案例</h3><p>披萨项目新的需求：客户在点披萨时，可以点不同口味的披萨，比如北京的奶酪 pizza、北京的胡椒 pizza 或者是伦敦的奶酪 pizza、伦敦的胡椒 pizza。</p><blockquote><p>思路 1</p></blockquote><p>使用简单工厂模式，创建不同的简单工厂类，比如 <code>BJPizzaSimpleFactory</code>、<code>LDPizzaSimpleFactory</code> 等等。从当前这个案例来说，也是可以的，但是考虑到项目的规模，以及软件的可维护性、可扩展性并不是特别好。</p><blockquote><p>思路 2</p></blockquote><p>使用工厂模式。</p><p>工厂方法模式设计方案：将披萨项目的实例化功能抽象成抽象方法，在不同的口味点餐子类中具体实现。</p><blockquote><p>思路分析图解</p></blockquote><figure><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/design-pattern/20220227140636.png" alt="image-20220227140635359" tabindex="0" loading="lazy"><figcaption>image-20220227140635359</figcaption></figure><blockquote><p>代码实现</p></blockquote><p>披萨类代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 将 Pizza 类做成抽象</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Pizza</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span> <span class="token comment">//名字</span>

    <span class="token comment">// 准备原材料, 不同的披萨不一样，因此，我们做成抽象方法</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 省略 setter、getter 方法</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">BJCheesePizza</span> <span class="token keyword">extends</span> <span class="token class-name">Pizza</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;北京的奶酪 pizza&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; 北京的奶酪 pizza 准备原材料&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">BJPepperPizza</span> <span class="token keyword">extends</span> <span class="token class-name">Pizza</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;北京的胡椒 pizza&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; 北京的胡椒 pizza 准备原材料&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">LDCheesePizza</span> <span class="token keyword">extends</span> <span class="token class-name">Pizza</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;伦敦的奶酪 pizza&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; 伦敦的奶酪 pizza 准备原材料&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">LDPepperPizza</span> <span class="token keyword">extends</span> <span class="token class-name">Pizza</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;伦敦的奶酪 pizza&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; 伦敦的奶酪 pizza 准备原材料&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>工厂方法模式代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">OrderPizzaFactory</span> <span class="token punctuation">{</span>

    <span class="token comment">// 定义一个抽象方法，createPizza，让各个工厂子类自己实现</span>
    <span class="token keyword">abstract</span> <span class="token class-name">Pizza</span> <span class="token function">createPizza</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderType<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 构造器</span>
    <span class="token keyword">public</span> <span class="token class-name">OrderPizza</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        pizza <span class="token operator">=</span> <span class="token function">createPizza</span><span class="token punctuation">(</span>orderType<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 抽象方法，由工厂子类完成</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由工厂方法模式创建的子类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PizzaStore</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建北京口味的各种 Pizza</span>
        <span class="token class-name">BJOrderPizzaFactory</span> bJOrderPizzaFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BJOrderPizzaFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Pizza</span> pizza1 <span class="token operator">=</span> bJOrderPizzaFactory<span class="token punctuation">.</span><span class="token function">createPizza</span><span class="token punctuation">(</span><span class="token string">&quot;cheese&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Pizza</span> pizza2<span class="token operator">=</span> bJOrderPizzaFactory<span class="token punctuation">.</span><span class="token function">createPizza</span><span class="token punctuation">(</span><span class="token string">&quot;pepper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>pizza1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>pizza2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 创建伦敦口味的各种 Pizza</span>
        <span class="token class-name">LDOrderPizzaFactory</span> lDOrderPizzaFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LDOrderPizzaFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Pizza</span> pizza3 <span class="token operator">=</span> lDOrderPizzaFactory<span class="token punctuation">.</span><span class="token function">createPizza</span><span class="token punctuation">(</span><span class="token string">&quot;cheese&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Pizza</span> pizza4 <span class="token operator">=</span> lDOrderPizzaFactory<span class="token punctuation">.</span><span class="token function">createPizza</span><span class="token punctuation">(</span><span class="token string">&quot;pepper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>pizza3<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>pizza4<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">BJOrderPizzaFactory</span> <span class="token keyword">extends</span> <span class="token class-name">OrderPizzaFactory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">Pizza</span> <span class="token function">createPizza</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>orderType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;cheese&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BJCheesePizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>orderType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;pepper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BJPepperPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> pizza<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">LDOrderPizzaFactory</span> <span class="token keyword">extends</span> <span class="token class-name">OrderPizzaFactory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">Pizza</span> <span class="token function">createPizza</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Pizza</span> pizza <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>orderType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;cheese&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LDCheesePizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>orderType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;pepper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pizza <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LDPepperPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> pizza<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果新增一个新的类如希腊披萨，则只需要新增两个类：希腊披萨类（继承 Pizza 类）、希腊披萨工厂类（继承 OrderPizzaFactory）。不会修改其他的代码，满足了 OCP 开闭原则，但是相比较简单工厂模式，花费的代码比较高。</p><h3 id="什么时候该用工厂方法模式-而非简单工厂模式呢" tabindex="-1"><a class="header-anchor" href="#什么时候该用工厂方法模式-而非简单工厂模式呢" aria-hidden="true">#</a> 什么时候该用工厂方法模式，而非简单工厂模式呢？</h3><p>之所以将某个代码块剥离出来，独立为函数或者类，原因是这个代码块的逻辑过于复杂，剥离之后能让代码更加清晰，更加可读、可维护。但是，如果代码块本身并不复杂，就几行代码而已，我们完全没必要将它拆分成单独的函数或者类。</p><p>基于这个设计思想，当对象的创建逻辑比较复杂，不只是简单的 new 一下就可以，而是要组合其他类对象，做各种初始化操作的时候，我们推荐使用工厂方法模式，将复杂的创建逻辑拆分到多个工厂类中，让每个工厂类都不至于过于复杂。而使用简单工厂模式，将所有的创建逻辑都放到一个工厂类中，会导致这个工厂类变得很复杂。</p><p>除此之外，在某些场景下，如果对象不可复用，那工厂类 <strong>每次都要返回不同的对象</strong>。如果我们使用简单工厂模式来实现，就只能选择第一种包含 if 分支逻辑的实现方式。如果我们还想避免烦人的 if-else 分支逻辑，这个时候，我们就推荐使用工厂方法模式。</p><p>工厂方法模式可以理解为在多个简单工厂模式（子工厂）的基础上再创建一个大的工厂，统一管理多个子工厂。</p><table><thead><tr><th>复杂度</th><th>优势模式</th></tr></thead><tbody><tr><td>结构复杂度</td><td>简单工厂模式</td></tr><tr><td>代码复杂度</td><td>简单工厂模式</td></tr><tr><td>编程复杂度</td><td>简单工厂模式</td></tr><tr><td>管理复杂度</td><td>简单工厂模式</td></tr><tr><td>根据实际业务</td><td>简单工厂模式</td></tr><tr><td>根据设计原则</td><td>工厂方法模式</td></tr></tbody></table><p>应用场景：</p><ul><li>客户只知道创建产品的工厂名，而不知道具体的产品名。如 TCL 电视工厂、海信电视工厂等</li><li>创建对象的任务由多个具体子工厂中的某一个完成，而抽象工厂只提供创建产品的接口</li><li>客户不关心创建产品的细节，只关心产品的品牌</li></ul><h2 id="抽象工厂-abstract-factory" tabindex="-1"><a class="header-anchor" href="#抽象工厂-abstract-factory" aria-hidden="true">#</a> 抽象工厂（Abstract Factory）</h2><h3 id="基本介绍" tabindex="-1"><a class="header-anchor" href="#基本介绍" aria-hidden="true">#</a> 基本介绍</h3><ul><li><strong>抽象工厂模式</strong>：定义了一个 interface 用于创建相关或有依赖关系的对象簇，而无需指明具体的类</li><li>抽象工厂模式可以将简单工厂模式和工厂方法模式进行整合，是工厂方法模式的升级版本，工厂方法模式只生产一个等级的产品，而抽象工厂模式可生产多个等级的产品</li><li>从设计层面看，抽象工厂模式就是对简单工厂模式的改进（或者称为进一步的抽象）</li><li>将工厂抽象成两层，AbsFactory（抽象工厂）和具体实现的工厂子类。程序员可以根据创建对象类型使用对应的工厂子类。这样将单个的简单工厂类变成了 <strong>工厂簇</strong>，更利于代码的维护和扩展</li></ul><blockquote><p>优点</p></blockquote><p>除了具有工厂方法模式的优点外，还有：</p><ul><li>可以在类的内部对产品族中相关联的多等级产品共同管理，而不必专门引入多个新的类来进行管理。</li><li>当需要产品族时，抽象工厂可以保证客户端始终只使用同一个产品的产品组。</li><li>抽象工厂增强了程序的可扩展性，当增加一个新的产品族时，不需要修改原代码，满足开闭原则。</li></ul><blockquote><p>主要缺点</p></blockquote><p>当产品族中需要增加一个新的产品时，所有的工厂类都需要进行修改。增加了系统的抽象性和理解难度。</p><blockquote><p>主要角色</p></blockquote><ul><li>抽象工厂（Abstract Factory）：提供了创建产品的接口，它包含多个创建产品的方法 newProduct()，可以创建多个不同等级的产品</li><li>具体工厂（Concrete Factory）：主要是实现抽象工厂中的多个抽象方法，完成具体产品的创建</li><li>抽象产品（Product）：定义了产品的规范，描述了产品的主要特性和功能，抽象工厂模式有多个抽象产品</li><li>具体产品（ConcreteProduct）：实现了抽象产品角色所定义的接口，由具体工厂来创建，它同具体工厂之间是多对一的关系</li></ul><p>抽象工厂结构图：</p><figure><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/design-pattern/20220326223224.png" alt="image-20220326223223254" tabindex="0" loading="lazy"><figcaption>image-20220326223223254</figcaption></figure><p>上面的披萨案例抽象工厂类图：</p><figure><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/design-pattern/20220227141802.png" alt="image-20220227141801967" tabindex="0" loading="lazy"><figcaption>image-20220227141801967</figcaption></figure><h3 id="抽象工厂模式应用实例" tabindex="-1"><a class="header-anchor" href="#抽象工厂模式应用实例" aria-hidden="true">#</a> 抽象工厂模式应用实例</h3><p>换个案例：生产小米手机、小米路由器；华为手机、华为路由器。</p><figure><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/design-pattern/20220302213615.png" alt="image-20220301171914376" tabindex="0" loading="lazy"><figcaption>image-20220301171914376</figcaption></figure><blockquote><p>小米手机和华为手机称为 <strong>产品线</strong>，小米手机和小米路由器称为 <strong>产品簇</strong>。</p></blockquote><p>首先创建手机和路由器的接口类：（为了方便，放在一个代码块里）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 手机接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IPhoneProduct</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">sendMes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 路由器接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IRouterProduct</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建小米和华为的手机：（为了方便，放在一个代码块里）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 小米手机</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiaoMiPhone</span> <span class="token keyword">implements</span> <span class="token class-name">IPhoneProduct</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;打开小米手机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;关闭小米手机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;小米手机发送消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;小米手机打电话&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 华为手机</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HuaWeiPhone</span> <span class="token keyword">implements</span> <span class="token class-name">IPhoneProduct</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;打开华为手机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;关闭华为手机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;华为手机发送消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;华为手机打电话&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建小米和华为的路由器：（为了方便，放在一个代码块里）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 小米路由器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiaoMiRouter</span> <span class="token keyword">implements</span> <span class="token class-name">IRouterProduct</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;打开小米路由器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;关闭小米路由器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;设置小米路由器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;连接小米路由器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 华为路由器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HuaWeiMiRouter</span> <span class="token keyword">implements</span> <span class="token class-name">IRouterProduct</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;打开华为路由器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;关闭华为路由器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;设置华为路由器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;连接华为路由器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建抽象工厂和子工厂（小米工厂、华为工厂）（为了方便，放在一个代码块里）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 抽象工厂</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IProductFactory</span> <span class="token punctuation">{</span>
    <span class="token class-name">IPhoneProduct</span> <span class="token function">phoneProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IRouterProduct</span> <span class="token function">routerProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 小米工厂</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiaoMiFactory</span> <span class="token keyword">implements</span> <span class="token class-name">IProductFactory</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IPhoneProduct</span> <span class="token function">phoneProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">XiaoMiPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IRouterProduct</span> <span class="token function">routerProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">XiaoMiRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 华为工厂</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HuaWeiFactory</span> <span class="token keyword">implements</span> <span class="token class-name">IProductFactory</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IPhoneProduct</span> <span class="token function">phoneProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HuaWeiPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IRouterProduct</span> <span class="token function">routerProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HuaWeiMiRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试抽象工厂模式：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------------- 小米系列工厂 --------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XiaoMiFactory</span> xiaoMiFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XiaoMiFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IPhoneProduct</span> iPhoneProduct <span class="token operator">=</span> xiaoMiFactory<span class="token punctuation">.</span><span class="token function">phoneProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iPhoneProduct<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iPhoneProduct<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iPhoneProduct<span class="token punctuation">.</span><span class="token function">sendMes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iPhoneProduct<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">IRouterProduct</span> iRouterProduct <span class="token operator">=</span> xiaoMiFactory<span class="token punctuation">.</span><span class="token function">routerProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iRouterProduct<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iRouterProduct<span class="token punctuation">.</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iRouterProduct<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iRouterProduct<span class="token punctuation">.</span><span class="token function">setting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------------- 华为系列工厂 --------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HuaWeiFactory</span> huaWeiFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HuaWeiFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IPhoneProduct</span> iPhoneProduct1 <span class="token operator">=</span> huaWeiFactory<span class="token punctuation">.</span><span class="token function">phoneProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iPhoneProduct1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iPhoneProduct1<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iPhoneProduct1<span class="token punctuation">.</span><span class="token function">sendMes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iPhoneProduct1<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">IRouterProduct</span> iRouterProduct1 <span class="token operator">=</span> huaWeiFactory<span class="token punctuation">.</span><span class="token function">routerProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iRouterProduct1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iRouterProduct1<span class="token punctuation">.</span><span class="token function">link</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iRouterProduct1<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iRouterProduct1<span class="token punctuation">.</span><span class="token function">setting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="工厂模式在-jdk-calendar-应用的源码分析" tabindex="-1"><a class="header-anchor" href="#工厂模式在-jdk-calendar-应用的源码分析" aria-hidden="true">#</a> 工厂模式在 JDK-Calendar 应用的源码分析</h2><p>JDK 中的 Calendar 类中，就使用了简单工厂模式。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Factory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// getInstance 是 Calendar 静态方法</span>
        <span class="token class-name">Calendar</span> cal <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注意月份下标从 0 开始，所以取月份要+1</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;年:&quot;</span> <span class="token operator">+</span> cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;月:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">MONTH</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;日:&quot;</span> <span class="token operator">+</span> cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DAY_OF_MONTH</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;时:&quot;</span> <span class="token operator">+</span> cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">HOUR_OF_DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;分:&quot;</span> <span class="token operator">+</span> cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">MINUTE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;秒:&quot;</span> <span class="token operator">+</span> cal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">SECOND</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Calendar.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Calendar</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Calendar</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">createCalendar</span><span class="token punctuation">(</span><span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token class-name">Locale<span class="token punctuation">.</span>Category</span><span class="token punctuation">.</span><span class="token constant">FORMAT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Calendar</span> <span class="token function">createCalendar</span><span class="token punctuation">(</span><span class="token class-name">TimeZone</span> zone<span class="token punctuation">,</span><span class="token class-name">Locale</span> aLocale<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 根据 TimeZone zone, locale 创建对应的实例</span>
        <span class="token class-name">CalendarProvider</span> provider <span class="token operator">=</span> <span class="token class-name">LocaleProviderAdapter</span><span class="token punctuation">.</span><span class="token function">getAdapter</span><span class="token punctuation">(</span><span class="token class-name">CalendarProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> aLocale<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">getCalendarProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>provider <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> provider<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>zone<span class="token punctuation">,</span> aLocale<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> iae<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// fall back to the default instantiation</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Calendar</span> cal <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>aLocale<span class="token punctuation">.</span><span class="token function">hasExtensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> caltype <span class="token operator">=</span> aLocale<span class="token punctuation">.</span><span class="token function">getUnicodeLocaleType</span><span class="token punctuation">(</span><span class="token string">&quot;ca&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>caltype <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>caltype<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">case</span> <span class="token string">&quot;buddhist&quot;</span><span class="token operator">:</span>
                        cal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BuddhistCalendar</span><span class="token punctuation">(</span>zone<span class="token punctuation">,</span> aLocale<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">&quot;japanese&quot;</span><span class="token operator">:</span>
                        cal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JapaneseImperialCalendar</span><span class="token punctuation">(</span>zone<span class="token punctuation">,</span> aLocale<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">&quot;gregory&quot;</span><span class="token operator">:</span>
                        cal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GregorianCalendar</span><span class="token punctuation">(</span>zone<span class="token punctuation">,</span> aLocale<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cal <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// If no known calendar type is explicitly specified</span>
            <span class="token comment">// perform the traditional way to create a Calendar:</span>
            <span class="token comment">// create a BuddhistCalendar for th_TH locale</span>
            <span class="token comment">// a JapaneseImperialCalendar for ja_JP_JP locale, or</span>
            <span class="token comment">// a GregorianCalendar for any other locales</span>
            <span class="token comment">// NOTE: The language, country and variant strings are interned. </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>aLocale<span class="token punctuation">.</span><span class="token function">getLanguage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;th&quot;</span> <span class="token operator">&amp;&amp;</span> aLocale<span class="token punctuation">.</span><span class="token function">getCountry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;TH&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BuddhistCalendar</span><span class="token punctuation">(</span>zone<span class="token punctuation">,</span> aLocale<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>aLocale<span class="token punctuation">.</span><span class="token function">getVariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;JP&quot;</span> <span class="token operator">&amp;&amp;</span> aLocale<span class="token punctuation">.</span><span class="token function">getLanguage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;ja&quot;</span> <span class="token operator">&amp;&amp;</span> aLocale<span class="token punctuation">.</span><span class="token function">getCountry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;JP&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JapaneseImperialCalendar</span><span class="token punctuation">(</span>zone<span class="token punctuation">,</span> aLocale<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                cal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GregorianCalendar</span><span class="token punctuation">(</span>zone<span class="token punctuation">,</span> aLocale<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> cal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="工厂模式小结" tabindex="-1"><a class="header-anchor" href="#工厂模式小结" aria-hidden="true">#</a> 工厂模式小结</h2><ul><li>工厂模式的意义将实例化对象的代码提取出来，放到一个类中统一管理和维护，达到和主项目的依赖关系的解耦。从而提高项目的扩展和维护性</li><li>三种工厂模式 (简单工厂模式、工厂方法模式、抽象工厂模式）</li><li>设计模式的依赖抽象原则 <ul><li>创建对象实例时，不要直接 new 类, 而是把这个 new 类的动作放在一个工厂的方法中，并返回。有的书上说，变量不要直接持有具体类的引用</li><li>不要让类继承具体类，而是继承抽象类或者是实现 interface（接口）</li><li>不要覆盖基类中已经实现的方法</li></ul></li></ul><h2 id="如何设计实现一个dependency-injection框架" tabindex="-1"><a class="header-anchor" href="#如何设计实现一个dependency-injection框架" aria-hidden="true">#</a> 如何设计实现一个Dependency Injection框架</h2><p>当创建对象是一个「大工程」的时候，我们一般会选择使用工厂模式，来封装对象复杂的创建过程，将对象的创建和使用分离，让代码更加清晰。那何为「大工程」呢？上面我们讲了两种情况，一种是创建过程涉及复杂的 if-else 分支判断，另一种是对象创建需要组装多个其他类对象或者需要复杂的初始化过程。</p><p>我们来学习一个创建对象的「大工程」，依赖注入框架，或者叫依赖注入容器（Dependency Injection Container），简称 DI 容器。在今天的讲解中，我会带你一块搞清楚这样几个问题：DI 容器跟我们讲的工厂模式又有何区别和联系？DI 容器的核心功能有哪些，以及如何实现一个简单的 DI 容器？</p><h3 id="工厂模式和-di-容器有何区别" tabindex="-1"><a class="header-anchor" href="#工厂模式和-di-容器有何区别" aria-hidden="true">#</a> 工厂模式和 DI 容器有何区别</h3><p>实际上，DI 容器底层最基本的设计思路就是基于工厂模式的。DI 容器相当于一个大的工厂类，负责在程序启动的时候，根据配置（要创建哪些类对象，每个类对象的创建需要依赖哪些其他类对象）事先创建好对象。当应用程序需要使用某个类对象的时候，直接从容器中获取即可。正是因为它持有一堆对象，所以这个框架才被称为「容器」。</p><p>DI 容器相对于我们上面讲的工厂模式的例子来说，它处理的是更大的对象创建工程。上面讲的工厂模式中，一个工厂类只负责某个类对象或者某一组相关类对象（继承自同一抽象类或者接口的子类）的创建，而 DI 容器负责的是整个应用中所有类对象的创建。</p><p>除此之外，DI 容器负责的事情要比单纯的工厂模式要多。比如，它还包括配置的解析、对象生命周期的管理。接下来，我们就详细讲讲，一个简单的 DI 容器应该包含哪些核心功能。</p><h3 id="di-容器的核心功能有哪些" tabindex="-1"><a class="header-anchor" href="#di-容器的核心功能有哪些" aria-hidden="true">#</a> DI 容器的核心功能有哪些</h3><p>总结一下，一个简单的 DI 容器的核心功能一般有三个：配置解析、对象创建和对象生命周期管理。</p><blockquote><p>首先，我们来看配置解析。</p></blockquote><ol><li>在上面讲的工厂模式中，工厂类要创建哪个类对象是事先确定好的，并且是写死在工厂类代码中的。作为一个通用的框架来说，框架代码跟应用代码应该是高度解耦的，DI 容器事先并不知道应用会创建哪些对象，不可能把某个应用要创建的对象写死在框架代码中。所以，我们需要通过一种形式，让应用告知 DI 容器要创建哪些对象。这种形式就是我们要讲的配置</li><li>我们将需要由 DI 容器来创建的类对象和创建类对象的必要信息（使用哪个构造函数以及对应的构造函数参数都是什么等等），放到配置文件中。容器读取配置文件，根据配置文件提供的信息来创建对象</li><li>下面是一个典型的 Spring 容器的配置文件。Spring 容器读取这个配置文件，解析出要创建的两个对象：rateLimiter 和 redisCounter，并且得到两者的依赖关系：rateLimiter 依赖 redisCounter</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RateLimiter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisCounter</span> redisCounter<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">(</span><span class="token class-name">RedisCounter</span> redisCounter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>redisCounter <span class="token operator">=</span> redisCounter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisCounter</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> ipAddress<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisCounter</span><span class="token punctuation">(</span><span class="token class-name">String</span> ipAddress<span class="token punctuation">,</span> <span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ipAddress <span class="token operator">=</span> ipAddress<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置文件 beans.xml：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rateLimiter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.gavin.RateLimiter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>redisCounter<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>redisCounter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.gavin.redisCounter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>String<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>127.0.0.1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>1234/</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>其次，我们再来看对象创建。</p></blockquote><p>在 DI 容器中，如果我们给每个类都对应创建一个工厂类，那项目中类的个数会成倍增加，这会增加代码的维护成本。要解决这个问题并不难。我们只需要将所有类对象的创建都放到一个工厂类中完成就可以了，比如 BeansFactory。</p><p>你可能会说，如果要创建的类对象非常多，BeansFactory 中的代码会不会线性膨胀（代码量跟创建对象的个数成正比）呢？实际上并不会。待会讲到 DI 容器的具体实现的时候，我们会讲「反射」这种机制，它能在程序运行的过程中，动态地加载类、创建对象，不需要事先在代码中写死要创建哪些对象。所以，不管是创建一个对象还是十个对象，BeansFactory 工厂类代码都是一样的。</p><blockquote><p>最后，我们来看对象的生命周期管理。</p></blockquote><p>上面我们讲到，简单工厂模式有两种实现方式，一种是每次都返回新创建的对象，另一种是每次都返回同一个事先创建好的对象，也就是所谓的单例对象。在 Spring 框架中，我们可以通过配置 scope 属性，来区分这两种不同类型的对象。<code>scope=prototype</code> 表示返回新创建的对象，<code>scope=singleton</code> 表示返回单例对象。</p><p>除此之外，我们还可以配置对象是否支持懒加载。如果 <code>lazy-init=true</code>，对象在真正被使用到的时候（比如：<code>BeansFactory.getBean(&quot;userService&quot;)</code>）才被被创建；如果 <code>lazy-init=false</code>，对象在应用启动的时候就事先创建好。</p><p>不仅如此，我们还可以配置对象的 <code>init-method</code> 和 <code>destroy-method</code> 方法，比如 <code>init-method=loadProperties()</code>，<code>destroy-method=updateConfigFile()</code>。DI 容器在创建好对象之后，会主动调用 <code>init-method</code> 属性指定的方法来初始化对象。在对象被最终销毁之前，DI 容器会主动调用 <code>destroy-method</code> 属性指定的方法来做一些清理工作，比如释放数据库连接池、关闭文件。</p><h2 id="如何实现一个简单的-di-容器" tabindex="-1"><a class="header-anchor" href="#如何实现一个简单的-di-容器" aria-hidden="true">#</a> 如何实现一个简单的 DI 容器？</h2><p>用 Java 语言来实现一个简单的 DI 容器，核心逻辑只需要包括这样两个部分：配置文件解析、根据配置文件通过「反射」语法来创建对象。</p><h3 id="最小原型设计" tabindex="-1"><a class="header-anchor" href="#最小原型设计" aria-hidden="true">#</a> 最小原型设计</h3><p>因为我们主要是讲解设计模式，所以，在今天的讲解中，我们只实现一个 DI 容器的最小原型。像 Spring 框架这样的 DI 容器，它支持的配置格式非常灵活和复杂。为了简化代码实现，重点讲解原理，在最小原型中，我们只支持下面配置文件中涉及的配置语法。</p><p>配置文件 beans.xml</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rateLimiter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.gavin.RateLimiter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>redisCounter<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>redisCounter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.gavin.redisCounter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>singleton<span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazy-init</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>String<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>127.0.0.1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>1234/</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最小原型的使用方式跟 Spring 框架非常类似，示例代码如下所示：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;beans.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RateLimiter</span> rateLimiter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RateLimiter</span><span class="token punctuation">)</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;rateLimiter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rateLimiter<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="提供执行入口" tabindex="-1"><a class="header-anchor" href="#提供执行入口" aria-hidden="true">#</a> 提供执行入口</h3><p>面向对象设计的最后一步是：组装类并提供执行入口。在这里，执行入口就是一组暴露给外部使用的接口和类。通过刚刚的最小原型使用示例代码，我们可以看出，执行入口主要包含两部分：<code>ApplicationContext</code> 和 <code>ClassPathXmlApplicationContext</code>。其中 <code>ApplicationContext</code> 是接口，<code>ClassPathXmlApplicationContext</code> 是接口的实现类。两个类具体实现如下所示：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationContext</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassPathXmlApplicationContext</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContext</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">BeansFactory</span> beansFactory<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">BeanConfigParser</span> beanConfigParser<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> configLocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beansFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeansFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanConfigParser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlBeanConfigParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>configLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">String</span> configLocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            in <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> configLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Can not find config file: &quot;</span> <span class="token operator">+</span> configLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> beanDefinitions <span class="token operator">=</span> beanConfigParser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
            beansFactory<span class="token punctuation">.</span><span class="token function">addBeanDefinitions</span><span class="token punctuation">(</span>beanDefinitions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>in <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// TODO: log error</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> beansFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>beanId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从上面的代码中，我们可以看出，ClassPathXmlApplicationContext 负责组装 BeansFactory 和 BeanConfigParser 两个类，串联执行流程：从 classpath 中加载 XML 格式的配置文件，通过 BeanConfigParser 解析为统一的 BeanDefinition 格式，然后，BeansFactory 根据 BeanDefinition 来创建对象。</p><h3 id="配置文件解析" tabindex="-1"><a class="header-anchor" href="#配置文件解析" aria-hidden="true">#</a> 配置文件解析</h3><p>配置文件解析主要包含 BeanConfigParser 接口和 XmlBeanConfigParser 实现类，负责将配置文件解析为 BeanDefinition 结构，以便 BeansFactory 根据这个结构来创建对象。配置文件的解析比较繁琐，不涉及我们要讲的理论知识，不是我们讲解的重点，所以这里我只给出两个类的大致设计思路，并未给出具体的实现代码。如果感兴趣的话，你可以自行补充完整。具体的代码框架如下所示：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanConfigParser</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> configContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XmlBeanConfigParser</span> <span class="token keyword">implements</span> <span class="token class-name">BeanConfigParser</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// TODO:...</span>
        <span class="token keyword">return</span> <span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> configContent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> beanDefinitions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// TODO:...</span>
        <span class="token keyword">return</span> beanDefinitions<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanDefinition</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> className<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConstructorArg</span><span class="token punctuation">&gt;</span></span> constructorArgs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Scope</span> scope <span class="token operator">=</span> <span class="token class-name">Scope</span><span class="token punctuation">.</span><span class="token constant">SINGLETON</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> lazyInit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// 省略必要的 getter/setter/constructors</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Scope</span><span class="token punctuation">.</span><span class="token constant">SINGLETON</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">enum</span> <span class="token class-name">Scope</span> <span class="token punctuation">{</span>
        <span class="token constant">SINGLETON</span><span class="token punctuation">,</span>
        <span class="token constant">PROTOTYPE</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ConstructorArg</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">boolean</span> isRef<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Class</span> type<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Object</span> arg<span class="token punctuation">;</span>
        <span class="token comment">// 省略必要的 getter/setter/constructors</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="核心工厂类设计" tabindex="-1"><a class="header-anchor" href="#核心工厂类设计" aria-hidden="true">#</a> 核心工厂类设计</h3><ol><li>最后，我们来看，BeansFactory 是如何设计和实现的。这也是我们这个 DI 容器最核心的一个类了。它负责根据从配置文件解析得到的 BeanDefinition 来创建对象</li><li>如果对象的 scope 属性是 singleton，那对象创建之后会缓存在 singletonObjects 这样一个 map 中，下次再请求此对象的时候，直接从 map 中取出返回，不需要重新创建。如果对象的 scope 属性是 prototype，那每次请求对象，BeansFactory 都会创建一个新的对象返回</li><li>实际上，BeansFactory 创建对象用到的主要技术点就是 Java 中的反射语法：一种动态加载类和创建对象的机制。我们知道，JVM 在启动的时候会根据代码自动地加载类、创建对象。至于都要加载哪些类、创建哪些对象，这些都是在代码中写死的，或者说提前写好的。但是，如果某个对象的创建并不是写死在代码中，而是放到配置文件中，我们需要在程序运行期间，动态地根据配置文件来加载类、创建对象，那这部分工作就没法让 JVM 帮我们自动完成了，我们需要利用 Java 提供的反射语法自己去编写代码</li></ol><p>搞清楚了反射的原理，BeansFactory 的代码就不难看懂了。具体代码实现如下所示：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeansFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> singletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> beanDefinitions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> beanDefinitionList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">:</span> beanDefinitionList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitions<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">:</span> beanDefinitionList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">isLazyInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> beanDefinition<span class="token punctuation">.</span><span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">createBean</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">=</span> beanDefinitions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>beanDefinition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchBeanDefinitionException</span><span class="token punctuation">(</span><span class="token string">&quot;Bean is not defined: &quot;</span> <span class="token operator">+</span> beanId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">createBean</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@VisibleForTesting</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> singletonObjects<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Class</span> beanClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition<span class="token punctuation">.</span>ConstructorArg</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getConstructorArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                bean <span class="token operator">=</span> beanClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argClasses <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span>args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">BeanDefinition<span class="token punctuation">.</span>ConstructorArg</span> arg <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arg<span class="token punctuation">.</span><span class="token function">getIsRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        argClasses<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        argObjects<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">getArg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token class-name">BeanDefinition</span> refBeanDefinition <span class="token operator">=</span> beanDefinitions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span><span class="token function">getArg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>refBeanDefinition <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchBeanDefinitionException</span><span class="token punctuation">(</span><span class="token string">&quot;Bean is not defined: &quot;</span> <span class="token operator">+</span> arg<span class="token punctuation">.</span><span class="token function">getArg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        argClasses<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>refBeanDefinition<span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        argObjects<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">createBean</span><span class="token punctuation">(</span>refBeanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                bean <span class="token operator">=</span> beanClass<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span>argClasses<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>argObjects<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> <span class="token operator">|</span> <span class="token class-name">IllegalAccessException</span>
                 <span class="token operator">|</span> <span class="token class-name">InstantiationException</span> <span class="token operator">|</span> <span class="token class-name">NoSuchMethodException</span> <span class="token operator">|</span> <span class="token class-name">InvocationTargetException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanCreationFailureException</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> beanDefinition<span class="token punctuation">.</span><span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            singletonObjects<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>执行入口那里调用 <code>addBeanDefinitions</code></li><li>然后 <code>addBeanDefinitions</code> 再调用 <code>createBean</code> 利用反射创建对象，如果对象的 scope 属性是 singleton，那对象创建之后会缓存在 <code>singletonObjects</code> 这样一个 Map 中</li><li>最后最小原型设计那里再调用 <code>getBean从singletonObjects</code> 获取对象</li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/gavin-james/gavin-james.github.io/edit/main/docs/develop/design/factory.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: meaganlindesy1258@gmail.com">gavin-james</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/develop/design/single.html" class="nav-link prev" aria-label="创建型单例模式"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->创建型单例模式</div></a><a href="/develop/design/prototype.html" class="nav-link next" aria-label="创建型原型模式"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">创建型原型模式<!----></div></a></nav><div class="twikoo-wrapper" id="comment" style="display:block;" darkmode="false"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">默认页脚</div><div class="copyright">Copyright © 2023 gavin-james</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-f100e154.js" defer></script>
  </body>
</html>
